
<!---
Copyright 2017 Matthijs Vynck
[//]: # (Comment) This program is free software: you can redistribute it and/or modify
[//]: # (Comment) it under the terms of the GNU General Public License as published by
[//]: # (Comment) the Free Software Foundation, either version 3 of the License, or
[//]: # (Comment) any later version.
[//]: # (Comment)
[//]: # (Comment) This program is distributed in the hope that it will be useful,
[//]: # (Comment) but WITHOUT ANY WARRANTY; without even the implied warranty of
[//]: # (Comment) MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
[//]: # (Comment) GNU General Public License for more details.
[//]: # (Comment)
[//]: # (Comment) You should have received a copy of the GNU General Public License
[//]: # (Comment) along with this program.  If not, see <http://www.gnu.org/licenses/>.
[//]: # (Comment)
[//]: # (Comment) Topic: R Markdown file for generating a digital PCR power report
[//]: # (Comment) Author: Matthijs.Vynck@UGent.be
[//]: # (Comment) Modified by: -
[//]: # (Comment) Date created: Jan 17, 2018
[//]: # (Comment) Last updated: Feb 28, 2018
-->

---
output: pdf_document
header-includes:
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \fancyhead{}
- \fancyfoot[LE,LO]{Report generated by dPowerCalcR v1.0 on `r format(Sys.time(), '%B %d, %Y')`}
- \fancyfoot[RE,RO]{\thepage}
- \fancyfoot[CE,CO]{}
- \fancypagestyle{plain}{\pagestyle{fancy}}
---


`r input$reportTitle`
=======================

Input parameters
=======================

```{r echo=FALSE}
    
	dat<-unlist(dat)
	dat.table <- dat[1:8]
	names(dat.table) <- c("Number of replicates", "Number of partitions",
		"Between-replicate variability", "Effect size", "Fraction of negative partitions",
		"Significance level", "Partition volume", "Hypothesis")

```

```{r params, echo=FALSE}
	library(knitr)	
	kable(dat.table)

```

Power
=======================

```{r echo=FALSE}
    
	power <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],
			r=paramsABS()[["replicates"]],
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			N=paramsABS()[["partitions"]],
			interrep=paramsABS()[["interrep"]],
			alternative=paramsABS()[["alternative"]],
			ylim=c(0,1)
	)


```

The power for the specified parameters is: `r round(power,4)*100`%.

Plots for power optimization
=======================

```{r echo=FALSE}
	#effect size / number of partitions
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],
			r=paramsABS()[["replicates"]],
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			Nmin=paramsABS()[["minpart"]],
			Nmax=paramsABS()[["maxpart"]],
			interrep=paramsABS()[["interrep"]],
			alternative=paramsABS()[["alternative"]],
			ylim=c(0,1))
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),
			r=paramsABS()[["replicates"]],
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			Nmin=paramsABS()[["minpart"]],
			Nmax=paramsABS()[["maxpart"]],
			interrep=paramsABS()[["interrep"]],
			alternative=paramsABS()[["alternative"]],
			ylim=c(0,1),
			add=T,lty=2)
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),
			r=paramsABS()[["replicates"]],
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			Nmin=paramsABS()[["minpart"]],
			Nmax=paramsABS()[["maxpart"]],
			interrep=paramsABS()[["interrep"]],
			alternative=paramsABS()[["alternative"]],
			add=T,lty=3)
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],
			r=paramsABS()[["replicates"]],
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			Nmin=paramsABS()[["minpart"]],
			Nmax=paramsABS()[["maxpart"]],
			interrep=paramsABS()[["interrep"]],
			alternative=paramsABS()[["alternative"]],
			add=T,lty=4)
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")
    cat("\n")
```
\vspace{10pt}

```{r echo=FALSE}
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],
			r=paramsABS()[["replicates"]],
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			N=paramsABS()[["partitions"]],
			interrep=paramsABS()[["interrep"]],
			alternative=paramsABS()[["alternative"]],
			ylim=c(0,1))
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),
			r=paramsABS()[["replicates"]],
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			N=paramsABS()[["partitions"]],
			interrep=paramsABS()[["interrep"]],
			alternative=paramsABS()[["alternative"]],
			ylim=c(0,1),
			add=T,lty=2)
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),
			r=paramsABS()[["replicates"]],
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			N=paramsABS()[["partitions"]],
			interrep=paramsABS()[["interrep"]],
			alternative=paramsABS()[["alternative"]],
			add=T,lty=3)
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],
			r=paramsABS()[["replicates"]],
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			N=paramsABS()[["partitions"]],
			interrep=paramsABS()[["interrep"]],
			alternative=paramsABS()[["alternative"]],
			add=T,lty=4)
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	
```
\vspace{10pt}

<br>
&nbsp;

```{r echo=FALSE}
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			N=paramsABS()[["partitions"]],
			rmin=paramsABS()[["minrep"]],
			rmax=paramsABS()[["maxrep"]],
			interrep=paramsABS()[["interrep"]],
			alternative=paramsABS()[["alternative"]],
			ylim=c(0,1))
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			N=paramsABS()[["partitions"]],
			rmin=paramsABS()[["minrep"]],
			rmax=paramsABS()[["maxrep"]],
			interrep=paramsABS()[["interrep"]],
			alternative=paramsABS()[["alternative"]],
			ylim=c(0,1),
			add=T,lty=2)
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			N=paramsABS()[["partitions"]],
			rmin=paramsABS()[["minrep"]],
			rmax=paramsABS()[["maxrep"]],
			interrep=paramsABS()[["interrep"]],
			alternative=paramsABS()[["alternative"]],
			add=T,lty=3)
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			N=paramsABS()[["partitions"]],
			rmin=paramsABS()[["minrep"]],
			rmax=paramsABS()[["maxrep"]],
			interrep=paramsABS()[["interrep"]],
			alternative=paramsABS()[["alternative"]],
			add=T,lty=4)
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	
```
\vspace{10pt}

<br>
&nbsp;

```{r echo=FALSE}

	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			N=paramsABS()[["partitions"]],
			r=paramsABS()[["minrep"]],
			interrepmin=paramsABS()[["minrepl"]],
			interrepmax=paramsABS()[["maxrepl"]],
			alternative=paramsABS()[["alternative"]],
			ylim=c(0,1))
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			N=paramsABS()[["partitions"]],
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),
			interrepmin=paramsABS()[["minrepl"]],
			interrepmax=paramsABS()[["maxrepl"]],
			alternative=paramsABS()[["alternative"]],
			ylim=c(0,1),
			add=T,lty=2)
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			N=paramsABS()[["partitions"]],
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),
			interrepmin=paramsABS()[["minrepl"]],
			interrepmax=paramsABS()[["maxrepl"]],
			alternative=paramsABS()[["alternative"]],
			add=T,lty=3)
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],
			NNeg.fr=paramsABS()[["fraction"]],
			Vp=paramsABS()[["Vp"]],
			alpha=paramsABS()[["significance"]],
			N=paramsABS()[["partitions"]],
			r=paramsABS()[["maxrep"]],
			interrepmin=paramsABS()[["minrepl"]],
			interrepmax=paramsABS()[["maxrepl"]],
			alternative=paramsABS()[["alternative"]],
			add=T,lty=4)
	legend.char <- c((paramsABS()[["minrep"]]),
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),
					(paramsABS()[["maxrep"]]))	
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	


```