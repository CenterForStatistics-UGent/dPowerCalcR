
<!---
Copyright 2017 Matthijs Vynck
[//]: # (Comment) This program is free software: you can redistribute it and/or modify
[//]: # (Comment) it under the terms of the GNU General Public License as published by
[//]: # (Comment) the Free Software Foundation, either version 3 of the License, or
[//]: # (Comment) any later version.
[//]: # (Comment)
[//]: # (Comment) This program is distributed in the hope that it will be useful,
[//]: # (Comment) but WITHOUT ANY WARRANTY; without even the implied warranty of
[//]: # (Comment) MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
[//]: # (Comment) GNU General Public License for more details.
[//]: # (Comment)
[//]: # (Comment) You should have received a copy of the GNU General Public License
[//]: # (Comment) along with this program.  If not, see <http://www.gnu.org/licenses/>.
[//]: # (Comment)
[//]: # (Comment) Topic: R Markdown file for generating a digital PCR power report
[//]: # (Comment) Author: Matthijs.Vynck@UGent.be
[//]: # (Comment) Modified by: -
[//]: # (Comment) Date created: Jan 17, 2018
[//]: # (Comment) Last updated: Jan 17, 2018
-->

---
output: pdf_document
header-includes:
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \fancyhead{}
- \fancyfoot[LE,LO]{Report generated by dPowerCalcR v1.0 on `r format(Sys.time(), '%B %d, %Y')`}
- \fancyfoot[RE,RO]{\thepage}
- \fancyfoot[CE,CO]{}
- \fancypagestyle{plain}{\pagestyle{fancy}}
---

`r input$reportTitle`
=======================

Input parameters
=======================

```{r echo=FALSE}
    
	dat<-unlist(dat)
	dat.table <- dat[1:8]
	names(dat.table) <- c("Number of replicates", "Number of partitions",
		"Between-replicate variability", "Effect size", "Fraction of negative partitions",
		"Significance level", "Expected number of copies", "Hypothesis")

```

```{r params, echo=FALSE}
	library(knitr)	
	kable(dat.table)

```

Power
=======================

```{r echo=FALSE}
    
	power <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],
			r=paramsCNV()[["replicates"]],
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			N=paramsCNV()[["partitions"]],
			interrep=paramsCNV()[["interrep"]],
			alternative=paramsCNV()[["alternative"]],
			ylim=c(0,1)
	)


```

The power for the specified parameters is: `r round(power,4)*100`%.

Plots for power optimization
=======================

```{r echo=FALSE}
	power.ddPCR(delta=paramsCNV()[["mineffect"]],
			r=paramsCNV()[["replicates"]],
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			Nmin=paramsCNV()[["minpart"]],
			Nmax=paramsCNV()[["maxpart"]],
			interrep=paramsCNV()[["interrep"]],
			alternative=paramsCNV()[["alternative"]],
			ylim=c(0,1))
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),
			r=paramsCNV()[["replicates"]],
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			Nmin=paramsCNV()[["minpart"]],
			Nmax=paramsCNV()[["maxpart"]],
			interrep=paramsCNV()[["interrep"]],
			alternative=paramsCNV()[["alternative"]],
			ylim=c(0,1),
			add=T,lty=2)
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),
			r=paramsCNV()[["replicates"]],
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			Nmin=paramsCNV()[["minpart"]],
			Nmax=paramsCNV()[["maxpart"]],
			interrep=paramsCNV()[["interrep"]],
			alternative=paramsCNV()[["alternative"]],
			add=T,lty=3)
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],
			r=paramsCNV()[["replicates"]],
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			Nmin=paramsCNV()[["minpart"]],
			Nmax=paramsCNV()[["maxpart"]],
			interrep=paramsCNV()[["interrep"]],
			alternative=paramsCNV()[["alternative"]],
			add=T,lty=4)
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")
```
\vspace{10pt}

<br>
&nbsp;

```{r echo=FALSE}
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],
			r=paramsCNV()[["replicates"]],
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			N=paramsCNV()[["partitions"]],
			interrep=paramsCNV()[["interrep"]],
			alternative=paramsCNV()[["alternative"]],
			ylim=c(0,1))
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),
			r=paramsCNV()[["replicates"]],
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			N=paramsCNV()[["partitions"]],
			interrep=paramsCNV()[["interrep"]],
			alternative=paramsCNV()[["alternative"]],
			ylim=c(0,1),
			add=T,lty=2)
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),
			r=paramsCNV()[["replicates"]],
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			N=paramsCNV()[["partitions"]],
			interrep=paramsCNV()[["interrep"]],
			alternative=paramsCNV()[["alternative"]],
			add=T,lty=3)
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],
			r=paramsCNV()[["replicates"]],
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			N=paramsCNV()[["partitions"]],
			interrep=paramsCNV()[["interrep"]],
			alternative=paramsCNV()[["alternative"]],
			add=T,lty=4)
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	
```
\vspace{10pt}

<br>
&nbsp;

```{r echo=FALSE}	
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			N=paramsCNV()[["partitions"]],
			rmin=paramsCNV()[["minrep"]],
			rmax=paramsCNV()[["maxrep"]],
			interrep=paramsCNV()[["interrep"]],
			alternative=paramsCNV()[["alternative"]],
			ylim=c(0,1))
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			N=paramsCNV()[["partitions"]],
			rmin=paramsCNV()[["minrep"]],
			rmax=paramsCNV()[["maxrep"]],
			interrep=paramsCNV()[["interrep"]],
			alternative=paramsCNV()[["alternative"]],
			ylim=c(0,1),
			add=T,lty=2)
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			N=paramsCNV()[["partitions"]],
			rmin=paramsCNV()[["minrep"]],
			rmax=paramsCNV()[["maxrep"]],
			interrep=paramsCNV()[["interrep"]],
			alternative=paramsCNV()[["alternative"]],
			add=T,lty=3)
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			N=paramsCNV()[["partitions"]],
			rmin=paramsCNV()[["minrep"]],
			rmax=paramsCNV()[["maxrep"]],
			interrep=paramsCNV()[["interrep"]],
			alternative=paramsCNV()[["alternative"]],
			add=T,lty=4)
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	
```
\vspace{10pt}

<br>
&nbsp;

```{r echo=FALSE}
    power.ddPCR.VB(delta=paramsCNV()[["effect"]],
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			N=paramsCNV()[["partitions"]],
			r=paramsCNV()[["minrep"]],
			interrepmin=paramsCNV()[["minrepl"]],
			interrepmax=paramsCNV()[["maxrepl"]],
			alternative=paramsCNV()[["alternative"]],
			ylim=c(0,1))
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			N=paramsCNV()[["partitions"]],
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),
			interrepmin=paramsCNV()[["minrepl"]],
			interrepmax=paramsCNV()[["maxrepl"]],
			alternative=paramsCNV()[["alternative"]],
			ylim=c(0,1),
			add=T,lty=2)
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			N=paramsCNV()[["partitions"]],
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),
			interrepmin=paramsCNV()[["minrepl"]],
			interrepmax=paramsCNV()[["maxrepl"]],
			alternative=paramsCNV()[["alternative"]],
			add=T,lty=3)
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],
			NNeg.fr=paramsCNV()[["fraction"]],
			NB=paramsCNV()[["NB"]],
			alpha=paramsCNV()[["significance"]],
			N=paramsCNV()[["partitions"]],
			r=paramsCNV()[["maxrep"]],
			interrepmin=paramsCNV()[["minrepl"]],
			interrepmax=paramsCNV()[["maxrepl"]],
			alternative=paramsCNV()[["alternative"]],
			add=T,lty=4)
	legend.char <- c((paramsCNV()[["minrep"]]),
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),
					(paramsCNV()[["maxrep"]]))	
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	


```