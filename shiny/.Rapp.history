shinyApp(ui,server)
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
library(lmtest)#
library(randtests)#
library(sandwich)#
library(cowplot)#
source("powerFunCNV.R")#
server<-function(input, output)({#
#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
output$plotCNV <- renderPlot({#
	par(mfrow=c(3,2))#
	#extract as paramsCNV()[["repl"]]#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			ylim=c(0,1),#
			add=T,lty=4)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			add=T,lty=2)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
#install.packages("shiny")#
#install.packages("shinydashboard")#
#install.packages("rhandsontable")#
#install.packages("shinyBS")#
#install.packages("rmarkdown")#
#install.packages("ggplot2")#
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
#
numSamples<-20#
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
     	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# COPY NUMBER #
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=650,#
				textInput("partitions","Number of partitions",value="1000"),#
				textInput("replicates","Number of replicates",value="20000"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="1.1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				HTML("<br><br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=650,#
				textInput("minpart","Minimum number of partitions",value="10000"),#
				textInput("maxpart","Maximum number of partitions",value="3"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.1"),#
				textInput("maxeffect", "Maximal effect size", value="1"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=650,#
				textInput("partitions","Number of partitions",value="15000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="1.1"),#
				sliderInput("fraction", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				HTML("<br><br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=650,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.1"),#
				textInput("maxeffect", "Maximal effect size", value="1"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=700,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Ploidy level of organism",value="2"),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=700,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.1"),#
				textInput("maxeffectCNV", "Maximal effect size", value="1"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,height=700,#
				plotOutput("plotCNV")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
ls()
shinyApp(ui,server)
#install.packages("shiny")#
#install.packages("shinydashboard")#
#install.packages("rhandsontable")#
#install.packages("shinyBS")#
#install.packages("rmarkdown")#
#install.packages("ggplot2")#
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
#
numSamples<-20#
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
     	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# COPY NUMBER #
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=650,#
				textInput("partitions","Number of partitions",value="1000"),#
				textInput("replicates","Number of replicates",value="20000"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="1.1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				HTML("<br><br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=650,#
				textInput("minpart","Minimum number of partitions",value="10000"),#
				textInput("maxpart","Maximum number of partitions",value="3"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.1"),#
				textInput("maxeffect", "Maximal effect size", value="1"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=650,#
				textInput("partitions","Number of partitions",value="15000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="1.1"),#
				sliderInput("fraction", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				HTML("<br><br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=650,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.1"),#
				textInput("maxeffect", "Maximal effect size", value="1"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=700,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Ploidy level of organism",value="2"),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=700,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.1"),#
				textInput("maxeffectCNV", "Maximal effect size", value="1"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				plotOutput("plotCNV",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
shinyApp(ui,server)
(1-pnorm(qnorm(1-alpha)-(delta-1)/sd.CNV))
(1-pnorm(qnorm(1-alpha)-(delta-1)/sd.CNV)+pnorm(qnorm(alpha)-(delta-1)/sd.CNV))
(1-pnorm(qnorm(1-alpha/2)-(delta-1)/sd.CNV)+pnorm(qnorm(alpha/2)-(delta-1)/sd.CNV))
delta<--0.1
(1-pnorm(qnorm(1-alpha/2)-(delta-1)/sd.CNV)+pnorm(qnorm(alpha/2)-(delta-1)/sd.CNV))
(1-pnorm(qnorm(1-alpha/2)-(delta-1)/sd.CNV))
delta<-0.9
(1-pnorm(qnorm(1-alpha/2)-(delta-1)/sd.CNV)+pnorm(qnorm(alpha/2)-(delta-1)/sd.CNV))
(1-pnorm(qnorm(1-alpha/2)-(delta-1)/sd.CNV))
sd.CNV
?selectInput
#install.packages("shiny")#
#install.packages("shinydashboard")#
#install.packages("rhandsontable")#
#install.packages("shinyBS")#
#install.packages("rmarkdown")#
#install.packages("ggplot2")#
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
#
numSamples<-20#
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
     	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# COPY NUMBER #
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=650,#
				textInput("partitions","Number of partitions",value="1000"),#
				textInput("replicates","Number of replicates",value="20000"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="1.1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				HTML("<br><br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=650,#
				textInput("minpart","Minimum number of partitions",value="10000"),#
				textInput("maxpart","Maximum number of partitions",value="3"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.1"),#
				textInput("maxeffect", "Maximal effect size", value="1"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=650,#
				textInput("partitions","Number of partitions",value="15000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="1.1"),#
				sliderInput("fraction", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				HTML("<br><br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=650,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.1"),#
				textInput("maxeffect", "Maximal effect size", value="1"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=750,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Ploidy level of organism",value="2"),#
				selectInput("AltCNV","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=700,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.1"),#
				textInput("maxeffectCNV", "Maximal effect size", value="1"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				plotOutput("plotCNV",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
#################################################################
####           Functions                                    #####
#################################################################
# variance of CNV based on first order taylor expansion. This is the variance that I derived using a first order Taylor expansion for Var(X/Y) with X and Y independently distributed. This is equivalent to the CI-based formulation of the approximation used by Bio-Rad#
varCNV2<-function(N,NNegA,delta,r,VarExcel,NB) {#
	# This function calculates the variance of the CNV estimate based on r replicates#
	##
	# based on estimate of between replicate variance#
	# based on first order Taylor expansion#
	# delta: CNV under H1#
	# N: total number of droplets#
	# NNegA: number of negatives for the reference#
	# r: number of replicates#
	# VarExcel: variance of r replicates calculated from Jo's Excel file#
	# NB: number of copies of reference species in genome#
	# we assume the covariance between the estimators of pA and pB is zero#
	##
	pA<-NNegA/N#
	pB<-pA^(NB/delta)#
	VarPA<-pA*(1-pA)/N#
	VarPB<-pA^(NB/delta)*(1-pA^(NB/delta))/N#
	vPoisson<-(delta/(pA*log(pA)))^2*VarPA+(delta^2/(NB*log(pA)*pB))^2*VarPB#
	VarBetween<-VarBetweenExcel(delta,VarExcel,NB)#
	if(VarBetween<0){VarBetween=0}#
	v<-(vPoisson+VarBetween)/r#
	return(v)#
}#
VarBetweenExcel<-function(delta,VarExcel,NB) {#
	# This function computes the between-sample variance #
	# based on Jo's Excel file#
	##
	# delta: CNV under H1#
	# VarExcel: variance of r replicates calculated from Jo's Excel file#
	##
	N<-13745 # from Jo's Excel file#
	NNegA<-11830 # from Jo's Excel file#
	# for a given delta	#
	pA<-NNegA/N#
	pB<-pA^(NB/delta)#
	VarPA<-pA*(1-pA)/N#
	VarPB<-pA^(NB/delta)*(1-pA^(NB/delta))/N#
	vPoisson<-(delta/(pA*log(pA)))^2*VarPA+(delta^2/(NB*log(pA)*pB))^2*VarPB#
	VarBetween<-VarExcel-vPoisson #
	return(VarBetween)#
}#
power.ddPCR<-function(delta=1,r=3,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0.5,1),Nmin=5000,Nmax=20000,interrep=0.0031,add=F,lty=1,alternative="two.sided") {#
	# This function computes and plots the power for testing H0: CNV=1 against H1: CNV=delta#
	# as a function of the total number of droplets#
	##
	# delta: CNV under H1#
	# NNegA.fr: fraction of negatives for the reference (fraction of total number of droplets)#
	# r: number of replicates#
	# NB: number of copies of reference species in genome	 #
	# alpha: significance level (one-sided)#
	# add=F: add=T --> line added to existing graph#
	# lty=1: line type to be used for plotting#
	##
	delta=delta+1#
	N<-seq(Nmin,Nmax,by=(Nmax-Nmin)/1000) # sequence of total number of droplets for which the power will be calculated#
	sd.CNV<-sapply(N,function(n,NNegA.fr,delta,NB) {#
		sqrt(varCNV2(n,NNegA=n*NNegA.fr,delta=delta,r=r,VarExcel=interrep,NB=NB))}, NNegA.fr=NNeg.fr,delta=delta,NB=NB)#
	if(alternative="greater"){#
		pwr<-(1-pnorm(qnorm(1-alpha)-(delta-1)/sd.CNV))#
	} else if(alternative="less"){#
		pwr<-(pnorm(qnorm(alpha)-(delta-1)/sd.CNV))#
	} else {#
		pwr<-(1-pnorm(qnorm(1-alpha/2)-(delta-1)/sd.CNV)+pnorm(qnorm(alpha/2)-(delta-1)/sd.CNV))#
	}#
	if(add) {#
		lines(N,pwr,lty=lty)#
	}#
	else {#
		plot(N,pwr,xlab="Total number of partitions",ylab="Power",type="l",main="",ylim=ylim,lty=lty)#
	}#
}#
power.ddPCR.N<-function(delta=1.1,r=3,N=14000,NB=2,alpha=0.05,ylim=c(0.5,1),add=F,lty=1,alternative="Two-sided") {#
	# This function computes and plots the power for testing H0: CNV=1 against H1: CNV=delta#
	# as a function of the fraction of negatives#
	##
	# delta: CNV under H1#
	# NNegA.fr: fraction of negatives for the reference (fraction of total number of droplets)#
	# r: number of replicates#
	# NB: number of copies of reference species in genome	 #
	# alpha: significance level (one-sided)#
	# add=F: add=T --> line added to existing graph#
	# lty=1: line type to be used for plotting#
	##
	NNeg.fr<-seq(0.01,0.99,by=0.001) # sequence of fractions of negatives#
	sd.CNV<-sapply(NNeg.fr,function(NNegA.fr,n,delta,NB) {#
		sqrt(varCNV2(n,NNegA=n*NNegA.fr,delta=delta,r=r,VarExcel=0.0031,NB=NB))}, n=N,delta=delta,NB=NB)#
	if(alternative="Greater"){#
		pwr<-(1-pnorm(qnorm(1-alpha)-(delta-1)/sd.CNV))#
	} else if(alternative="Less"){#
		pwr<-(pnorm(qnorm(alpha)-(delta-1)/sd.CNV))#
	} else {#
		pwr<-(1-pnorm(qnorm(1-alpha/2)-(delta-1)/sd.CNV)+pnorm(qnorm(alpha/2)-(delta-1)/sd.CNV))#
	}#
	print(paste("maximum power = ",max(pwr),", negative fraction = ",which(pwr==max(pwr))/length(pwr)))#
	if(add) {#
		lines(NNeg.fr,pwr,lty=lty)#
	}#
	else {#
		par(omi=c(0,0,0,0))#
		par(mar=c(2, 2.7, 0.2, 4.1), xpd=TRUE)#
		plot(NNeg.fr,pwr,xlab="",ylab="",type="l",main="",ylim=ylim,lty=lty,cex.axis=0.6,cex.lab=0.6,xaxt="n")#
		axis(1,padj=-2.5,cex.axis=0.6)#
		mtext(side = 2, text = "Power", line = 2, cex=.6)#
		mtext(side = 1, text = "Negative fraction of partitions", line = 1, cex=.6)#
	}#
}#
power.ddPCR.N.max<-function(delta.low=1.01,delta.high=1.50,step=0.01,r=3,N=14000,NB=2,alpha=0.05,ylim=c(0,1),add=F,lty=1,alternative="two.sided") {#
	# This function computes and plots the maximum power that can be achieved with N droplets, for testing H0: CNV=1 against H1: CNV=delta#
	##
	# delta: CNV under H1#
	# NNegA.fr: fraction of negatives for the reference (fraction of total number of droplets)#
	# r: number of replicates#
	# NB: number of copies of reference species in genome	 #
	# alpha: significance level (one-sided)#
	# add=F: add=T --> line added to existing graph#
	##
	NNeg.fr<-seq(0.01,0.99,by=0.001)#
	delta<-seq(delta.low,delta.high,step)#
	optimal.frac<-array(0,length(delta))#
	pwr<-array(0,length(delta))#
	for(i in 1:length(delta)){#
		sd.CNV<-sapply(NNeg.fr,function(NNegA.fr,n,delta,NB) {#
			sqrt(varCNV2(n,NNegA=n*NNegA.fr,delta=delta,r=r,VarExcel=0.0031,NB=NB))}, n=N,delta=delta[i],NB=NB)#
		pwr.temp<-(1-pnorm(qnorm(1-alpha)-(delta[i]-1)/sd.CNV))#
		pwr[i]<-max(pwr.temp) # #
		optimal.frac[i]<-which(pwr.temp==max(pwr.temp))/length(pwr.temp)#
	}#
	par(mfrow=c(1,2))#
	plot(delta,pwr,xlab="CNV",ylab="Maximum power achievable",type="l",main="",ylim=ylim,lty=lty)#
	plot(delta,optimal.frac,xlab="CNV",ylab="Optimal negative fraction",type="l",main="",ylim=c(0.3,0.35),lty=lty)#
	par(mfrow=c(1,1))#
}#
#
power.ddPCR.r<-function(delta=1.1,N=14000, NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0.5,1),add=F,lty=1,alternative="two.sided") {#
	# This function computes and plots the power for testing H0: CNV=1 against H1: CNV=delta for varying number of replicates#
	##
	# delta: CNV under H1#
	# NNegA.fr: fraction of negatives for the reference (fraction of total number of droplets)#
	# r: number of replicates#
	# NB: number of copies of reference species in genome	 #
	# alpha: significance level (one-sided)#
	# add=F: add=T --> line added to existing graph#
	##
	r<-2:10 # sequence of number of replicates for which the power is computed#
	sd.CNV<-sapply(r,function(n,N,NNegA.fr,delta,NB) {#
		sqrt(varCNV2(N,NNegA=N*NNegA.fr,delta=delta,r=n,VarExcel=0.0031,NB=NB))}, N=N,NNegA.fr=NNeg.fr,delta=delta,NB=NB)#
	if(alternative="greater"){#
		pwr<-(1-pnorm(qnorm(1-alpha)-(delta-1)/sd.CNV))#
	} else if(alternative="less"){#
		pwr<-(pnorm(qnorm(alpha)-(delta-1)/sd.CNV))#
	} else {#
		pwr<-(1-pnorm(qnorm(1-alpha/2)-(delta-1)/sd.CNV)+pnorm(qnorm(alpha/2)-(delta-1)/sd.CNV))#
	}#
	if(add) {#
		lines(r,pwr,lty=lty)#
	}#
	else {#
		plot(r,pwr,xlab="number of replicates",ylab="power",type="l",main="",ylim=ylim,lty=lty)#
	}#
}#
power.ddPCR.VB<-function(delta=1.1,N=14000, NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0.5,1),add=F,lty=1,r=3,alternative="two.sided") {#
	# This function computes and plots the power for testing H0: CNV=1 against H1: CNV=delta for varying number of replicates#
	##
	# delta: CNV under H1#
	# NNegA.fr: fraction of negatives for the reference (fraction of total number of droplets)#
	# r: number of replicates#
	# NB: number of copies of reference species in genome	 #
	# alpha: significance level (one-sided)#
	# add=F: add=T --> line added to existing graph#
	##
	VB<-seq(0.001,0.03,0.0005) # sequence of number of replicates for which the power is computed#
	sd.CNV<-sapply(r,function(n,N,NNegA.fr,delta,NB) {#
		sqrt(varCNV2(N,NNegA=N*NNegA.fr,delta=delta,r=n,VarExcel=VB,NB=NB))}, N=N,NNegA.fr=NNeg.fr,delta=delta,NB=NB)#
	if(alternative="greater"){#
		pwr<-(1-pnorm(qnorm(1-alpha)-(delta-1)/sd.CNV))#
	} else if(alternative="less"){#
		pwr<-(pnorm(qnorm(alpha)-(delta-1)/sd.CNV))#
	} else {#
		pwr<-(1-pnorm(qnorm(1-alpha/2)-(delta-1)/sd.CNV)+pnorm(qnorm(alpha/2)-(delta-1)/sd.CNV))#
	}#
	if(add) {#
		lines(VB,pwr,lty=lty)#
	}#
	else {#
		plot(VB,pwr,xlab="between-replicate variability",ylab="power",type="l",main="",ylim=ylim,lty=lty,xlim=c(0,max(VB)))#
	}#
}
power.ddPCR<-function(delta=1,r=3,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0.5,1),Nmin=5000,Nmax=20000,interrep=0.0031,add=F,lty=1,alternative="Two-sided") {#
	# This function computes and plots the power for testing H0: CNV=1 against H1: CNV=delta#
	# as a function of the total number of droplets#
	##
	# delta: CNV under H1#
	# NNegA.fr: fraction of negatives for the reference (fraction of total number of droplets)#
	# r: number of replicates#
	# NB: number of copies of reference species in genome	 #
	# alpha: significance level (one-sided)#
	# add=F: add=T --> line added to existing graph#
	# lty=1: line type to be used for plotting#
	##
	delta=delta+1#
	N<-seq(Nmin,Nmax,by=(Nmax-Nmin)/1000) # sequence of total number of droplets for which the power will be calculated#
	sd.CNV<-sapply(N,function(n,NNegA.fr,delta,NB) {#
		sqrt(varCNV2(n,NNegA=n*NNegA.fr,delta=delta,r=r,VarExcel=interrep,NB=NB))}, NNegA.fr=NNeg.fr,delta=delta,NB=NB)#
	if(alternative="Greater"){#
		pwr<-(1-pnorm(qnorm(1-alpha)-(delta-1)/sd.CNV))#
	} else if(alternative="Less"){#
		pwr<-(pnorm(qnorm(alpha)-(delta-1)/sd.CNV))#
	} else {#
		pwr<-(1-pnorm(qnorm(1-alpha/2)-(delta-1)/sd.CNV)+pnorm(qnorm(alpha/2)-(delta-1)/sd.CNV))#
	}#
	if(add) {#
		lines(N,pwr,lty=lty)#
	}#
	else {#
		plot(N,pwr,xlab="Total number of partitions",ylab="Power",type="l",main="",ylim=ylim,lty=lty)#
	}#
}
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
library(lmtest)#
library(randtests)#
library(sandwich)#
library(cowplot)#
source("powerFunCNV.R")#
server<-function(input, output)({#
#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
output$plotCNV <- renderPlot({#
	par(mfrow=c(3,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			ylim=c(0,1),#
			add=T,lty=4)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			add=T,lty=2)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
library(lmtest)#
library(randtests)#
library(sandwich)#
library(cowplot)#
source("powerFunCNV.R")#
server<-function(input, output)({#
#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
output$plotCNV <- renderPlot({#
	par(mfrow=c(3,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=4)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=2)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
library(lmtest)#
library(randtests)#
library(sandwich)#
library(cowplot)#
source("powerFunCNV.R")#
server<-function(input, output)({#
#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
output$plotCNV <- renderPlot({#
	par(mfrow=c(3,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
power.ddPCR(delta=-0.8)
power.ddPCR(delta=-0.1,add=T)
power.ddPCR(delta=-0.3,add=T)
-0.8+1-1
-0.3+1-1
-0.8+1
-0.3+1
N<-14000
NNegA<-12000
delta
pA<-NNegA/N#
	pB<-pA^(NB/delta)
pA
pB
delta<-0.2
pA<-NNegA/N#
	pB<-pA^(NB/delta)
pB
VarPA<-pA*(1-pA)/N#
	VarPB<-pA^(NB/delta)*(1-pA^(NB/delta))/N#
	vPoisson<-(delta/(pA*log(pA)))^2*VarPA+(delta^2/(NB*log(pA)*pB))^2*VarPB
vPoisson
delta<-0.9
pA<-NNegA/N#
	pB<-pA^(NB/delta)#
	VarPA<-pA*(1-pA)/N#
	VarPB<-pA^(NB/delta)*(1-pA^(NB/delta))/N#
	vPoisson<-(delta/(pA*log(pA)))^2*VarPA+(delta^2/(NB*log(pA)*pB))^2*VarPB
vPoisson
1/3*(2*-0.9+-0.1)
1/3*(-0.9+2*-0.1)
power.ddPCR<-function(delta=1,r=3,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0.5,1),Nmin=5000,Nmax=20000,interrep=0.0031,add=F,lty=1,alternative="Two-sided") {#
	# This function computes and plots the power for testing H0: CNV=1 against H1: CNV=delta#
	# as a function of the total number of droplets#
	##
	# delta: CNV under H1#
	# NNegA.fr: fraction of negatives for the reference (fraction of total number of droplets)#
	# r: number of replicates#
	# NB: number of copies of reference species in genome	 #
	# alpha: significance level (one-sided)#
	# add=F: add=T --> line added to existing graph#
	# lty=1: line type to be used for plotting#
	##
	N<-seq(Nmin,Nmax,by=(Nmax-Nmin)/1000) # sequence of total number of droplets for which the power will be calculated#
	sd.CNV<-sapply(N,function(n,NNegA.fr,delta,NB) {#
		sqrt(varCNV2(n,NNegA=n*NNegA.fr,delta=delta,r=r,VarExcel=interrep,NB=NB))}, NNegA.fr=NNeg.fr,delta=delta,NB=NB)#
	if(alternative=="Greater"){#
		pwr<-(1-pnorm(qnorm(1-alpha)-(delta-1)/sd.CNV))#
	} else if(alternative=="Less"){#
		pwr<-(pnorm(qnorm(alpha)-(delta-1)/sd.CNV))#
	} else {#
		pwr<-(1-pnorm(qnorm(1-alpha/2)-(delta-1)/sd.CNV)+pnorm(qnorm(alpha/2)-(delta-1)/sd.CNV))#
	}#
	if(add) {#
		lines(N,pwr,lty=lty)#
	}#
	else {#
		plot(N,pwr,xlab="Total number of partitions",ylab="Power",type="l",main="",ylim=ylim,lty=lty)#
	}#
}
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
library(lmtest)#
library(randtests)#
library(sandwich)#
library(cowplot)#
source("powerFunCNV.R")#
server<-function(input, output)({#
#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
output$plotCNV <- renderPlot({#
	par(mfrow=c(3,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
power.ddPCR(delta=-0.8)
power.ddPCR(delta=-0.3)
power.ddPCR(delta=-0.01)
power.ddPCR(delta=-0.01,ylim=c(0,1))
varCNV2(15000,15000*0.2,0.2,0.001,2)
varCNV2(15000,15000*0.2,0.2,3,0.001,2)
varCNV2(15000,15000*0.2,0.7,3,0.001,2)
pB<-0.2^(2/0.2)
pB
pA
pA<-0.2
-log(0.2)
-log(pB)
-log(0.2)
0.2^(2/1)
-log(0.04)
0.2^(1/0.5)
log(0.2)/log(0.04)
0.2^(2/0.5)
log(0.2)/log(0.0016)
n <- 15000#
neg.fr <- 0.2#
delta <- 1#
NB<-2#
#
pA <- neg.fr#
pB <- neg.fr^(1/delta)#
#
cnv <- log(pA)/log(pB)*NB#
cnv
n <- 15000#
neg.fr <- 0.2#
delta <- 1#
NB<-2#
#
pA <- neg.fr#
pB <- neg.fr^(NB/delta)#
#
cnv <- log(pA)/log(pB)*NB#
cnv
pa<-0.2
pb<-0.2^(2/1)
log(pa)/log(pb)
# variance of CNV based on first order taylor expansion. This is the variance that I derived using a first order Taylor expansion for Var(X/Y) with X and Y independently distributed. This is equivalent to the CI-based formulation of the approximation used by Bio-Rad#
varCNV2<-function(N,NNegA,delta,r,VarExcel,NB) {#
	# This function calculates the variance of the CNV estimate based on r replicates#
	##
	# based on estimate of between replicate variance#
	# based on first order Taylor expansion#
	# delta: CNV under H1#
	# N: total number of droplets#
	# NNegA: number of negatives for the target#
	# r: number of replicates#
	# VarExcel: variance of r replicates calculated from Jo's Excel file#
	# NB: number of copies of reference species in genome#
	# we assume the covariance between the estimators of pA and pB is zero#
	##
	pA<-NNegA/N#
	pB<-pA^(1/delta)#
	VarPA<-pA*(1-pA)/N#
	VarPB<-pA^(1/delta)*(1-pA^(1/delta))/N#
	vPoisson<-(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB#
	VarBetween<-VarBetweenExcel(delta,VarExcel,NB)#
	if(VarBetween<0){VarBetween=0}#
	v<-(vPoisson+VarBetween)/r#
	return(v)#
}#
VarBetweenExcel<-function(delta,VarExcel,NB) {#
	# This function computes the between-sample variance #
	# based on Jo's Excel file#
	##
	# delta: CNV under H1#
	# VarExcel: variance of r replicates calculated from Jo's Excel file#
	##
	N<-13745 # from Jo's Excel file#
	NNegA<-11830 # from Jo's Excel file#
	# for a given delta	#
	pA<-NNegA/N#
	pB<-pA^(NB/delta)#
	VarPA<-pA*(1-pA)/N#
	VarPB<-pA^(NB/delta)*(1-pA^(NB/delta))/N#
	vPoisson<-(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB#
	VarBetween<-VarExcel-vPoisson #
	return(VarBetween)#
}
power.ddPCR(delta=1.01,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,ylim=c(0,1))#
power.ddPCR(delta=1.2,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=4)#
power.ddPCR(delta=1.1,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,add=T,lty=3)#
power.ddPCR(delta=1.05,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,add=T,lty=2)#
legend("topright",legend=c("1%","5%","10%","20%"),lty=c(1:4), inset=c(-0.39,0),title="Effect size",cex=0.6)
power.ddPCR
power.ddPCR(delta=.01,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,ylim=c(0,1))#
power.ddPCR(delta=.2,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=4)#
power.ddPCR(delta=.1,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,add=T,lty=3)#
power.ddPCR(delta=.05,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,add=T,lty=2)#
legend("topright",legend=c("1%","5%","10%","20%"),lty=c(1:4), inset=c(-0.39,0),title="Effect size",cex=0.6)
power.ddPCR(delta=.01,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,ylim=c(0,1))#
power.ddPCR(delta=.2,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=4, interrep=0.001)#
power.ddPCR(delta=.1,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,add=T,lty=3)#
power.ddPCR(delta=.05,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,add=T,lty=2)#
legend("topright",legend=c("1%","5%","10%","20%"),lty=c(1:4), inset=c(-0.39,0),title="Effect size",cex=0.6)
power.ddPCR(delta=.01,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,ylim=c(0,1))#
power.ddPCR(delta=.2,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=4, interrep=0.031)#
power.ddPCR(delta=.1,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,add=T,lty=3)#
power.ddPCR(delta=.05,r=3,NNeg.fr=0.95,NB=2,alpha=0.05,add=T,lty=2)#
legend("topright",legend=c("1%","5%","10%","20%"),lty=c(1:4), inset=c(-0.39,0),title="Effect size",cex=0.6)
data <- read.csv("~/Dropbox/Work/Matthijs-Olivier/dPCR/CNVReplicates/Data/NIPD/NIPDmerged.csv",sep=";")#
head(data)#
#
n <- c()#
frac.neg <- c()#
RQ <- c()#
CN <- c()#
CN.mean <- c()#
CN.var <- c()#
#
for(i in 1:14){#
	for(j in 1:14){#
		cols <- c(i*2-1, i*2) + 1#
		rows <- c((j*3-2):(j*3))#
		data.subset <- data[rows, cols]#
		ref.subset <- data[rows, 28:29]#
		n <- c(n, unname(rowSums(data.subset)))#
		frac.neg <- c(frac.neg, unlist(unname(c(data.subset[2]/rowSums(data.subset)))))#
		CN.subset <- log(unlist(unname(c(data.subset[2]/rowSums(data.subset)))))/log(unlist(unname(c(ref.subset[2]/rowSums(ref.subset)))))#
		CN <- c(CN, CN.subset)#
		CN.mean <- c(CN.mean, mean(CN.subset, na.rm = TRUE))#
		CN.var <- c(CN.var, var(CN.subset, na.rm = TRUE))#
	}#
}#
n <- n[complete.cases(n)]#
frac.neg <- frac.neg[complete.cases(frac.neg)]#
frac.neg <- frac.neg[frac.neg != 1]#
CN.df <- data.frame(mean=CN.mean, var=CN.var)#
CN.df <- CN.df[complete.cases(CN.var), ]#
CN.var <- CN.var[complete.cases(CN.var)]#
#
CN.df <- CN.df[CN.var != 0, ]#
CN.var <- CN.var[CN.var != 0]
mean(CN.var)
max(CN.var)
power.ddPCR.VB(delta=1.1,r=3,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1))#
power.ddPCR.VB(delta=1.1,r=4,N=12000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=2)#
power.ddPCR.VB(delta=1.1,r=5,N=10000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=3)#
power.ddPCR.VB(delta=1.1,r=6,N=8000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=4)
varCNV2<-function(N,NNegA,delta,r,VarExcel,NB) {#
	# This function calculates the variance of the CNV estimate based on r replicates#
	##
	# based on estimate of between replicate variance#
	# based on first order Taylor expansion#
	# delta: CNV under H1#
	# N: total number of droplets#
	# NNegA: number of negatives for the target#
	# r: number of replicates#
	# VarExcel: variance of r replicates calculated from Jo's Excel file#
	# NB: number of copies of reference species in genome#
	# we assume the covariance between the estimators of pA and pB is zero#
	##
	pA<-NNegA/N#
	pB<-pA^(1/delta)#
	VarPA<-pA*(1-pA)/N#
	VarPB<-pA^(1/delta)*(1-pA^(1/delta))/N#
	vPoisson<-(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB#
	VarBetween<-VarBetweenExcel(delta,VarExcel,NB)#
	v<-(vPoisson+VarBetween)/r#
	return(v)#
}
power.ddPCR.VB(delta=1.1,r=3,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1))#
power.ddPCR.VB(delta=1.1,r=4,N=12000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=2)#
power.ddPCR.VB(delta=1.1,r=5,N=10000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=3)#
power.ddPCR.VB(delta=1.1,r=6,N=8000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=4)
# fixed total number of droplets and negative fraction. Power as a function of the betweel replicate variability#
#
power.ddPCR.VB(delta=1.5,r=3,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1))#
power.ddPCR.VB(delta=1.5,r=4,N=12000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=2)#
power.ddPCR.VB(delta=1.5,r=5,N=10000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=3)#
power.ddPCR.VB(delta=1.5,r=6,N=8000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=4)
# fixed total number of droplets and negative fraction. Power as a function of the betweel replicate variability#
#
power.ddPCR.VB(delta=1.05,r=3,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1))#
power.ddPCR.VB(delta=1.05,r=4,N=12000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=2)#
power.ddPCR.VB(delta=1.05,r=5,N=10000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=3)#
power.ddPCR.VB(delta=1.05,r=6,N=8000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=4)
# fixed total number of droplets and negative fraction. Power as a function of the betweel replicate variability#
#
power.ddPCR.VB(delta=1.05,r=3,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1))#
power.ddPCR.VB(delta=1.05,r=4,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=2)#
power.ddPCR.VB(delta=1.05,r=5,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=3)#
power.ddPCR.VB(delta=1.05,r=6,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=4)
varCNV<-function(N,NNegA,delta,r,NB) {#
	# based on first order Taylor expansion#
	# delta: CNV under H1#
	# N: total number of droplets#
	# NNegA: number of negatives for the reference#
	# number of replicates#
	# NB: number of copies of reference species in genome#
	# we assume the covariance between the estimators of pA and pB is zero#
	pA<-NNegA/N#
	pB<-pA^(1/delta)#
	VarPA<-pA*(1-pA)/N#
	VarPB<-pA^(1/delta)*(1-pA^(1/delta))/N#
	v<-(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB#
	v<-v/r#
	return(v)#
}
################################################################################
# simulation study to check the variance approximation#
B<-10000#
delta<-1.1#
pA<-0.7#
pB<-pA^(1/delta)#
N<-14000#
NNegA<-rbinom(B,size=N,prob=pA)#
NNegB<-rbinom(B,size=N,prob=pB)#
pA.hat<-NNegA/N#
pB.hat<-NNegB/N#
cnv<-NB*log(pA.hat)/log(pB.hat)#
# depending on the varCNV function you may have to choose one of the following lines#
vars<-sapply(NNegA,function(n) {varCNV(N=N,NNegA=n,delta=1.1,r=1,NB=2)})#
#vars<-sapply(NNegA,function(n) {varCNV.bootstrap(N=N,NNegA=n,delta=1.2,r=1,NB=2,B=10000)})#
#vars<-sapply(1:B,function(n) {varCNV.DensApprox(N=N,NNegA=NNegA[i],NNegB=NNegB[i],r=1,NB=2)})#
#hist(cnv)#
mean(cnv) # should be close to delta#
var(cnv)#
mean(vars) # should be close to var(cnv) so as to demonstrate that the variance estimation is good
# OT: this is how I check the correctness of the CIs#
# delta is given#
delta#
# Now I compute the lower and upper bounds for the simulated data#
#calculate CI for the CNV as given by Biorad#
CI.A.cA<-(log(pA.hat-qnorm(0.975)*sqrt(pA.hat*(1-pA.hat)/N))-log(pA.hat+qnorm(0.975)*sqrt(pA.hat*(1-pA.hat)/N)))/log(pA.hat)#
CI.B.cB<-(log(pB.hat-qnorm(0.975)*sqrt(pB.hat*(1-pB.hat)/N))-log(pB.hat+qnorm(0.975)*sqrt(pB.hat*(1-pB.hat)/N)))/log(pB.hat)#
CI.low.CNV.biorad<-log(pA.hat)/log(pB.hat)*NB-log(pA.hat)/log(pB.hat)*NB/2*sqrt(CI.A.cA^2+CI.B.cB^2)#
CI.high.CNV.biorad<-log(pA.hat)/log(pB.hat)*NB+log(pA.hat)/log(pB.hat)*NB/2*sqrt(CI.A.cA^2+CI.B.cB^2)#
# delta should be included B(1-alpha) times in the CI#
mean((CI.low.CNV.biorad<delta)&(CI.high.CNV.biorad>delta))#
#
# now (via inverse engineering) I calculate the variance estimator, starting from the CI of CNV#
vars2<-((CI.high.CNV.biorad-CI.low.CNV.biorad)/(2*1.96))^2#
mean(vars2)  # Biorad#
mean(vars)   # BioStat#
var(cnv)	 # BioSim
(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB
(delta/(pA*log(pA)))^2*VarPA+(delta^2/(NB*log(pA)*pB))^2*VarPB
VarBetweenExcel<-function(delta,VarExcel,NB) {#
	# This function computes the between-sample variance #
	# based on Jo's Excel file#
	##
	# delta: CNV under H1#
	# VarExcel: variance of r replicates calculated from Jo's Excel file#
	##
	N<-13745 # from Jo's Excel file#
	NNegA<-11830 # from Jo's Excel file#
	# for a given delta	#
	pA<-NNegA/N#
	pB<-pA^(1/delta)#
	VarPA<-pA*(1-pA)/N#
	VarPB<-pA^(1/delta)*(1-pA^(1/delta))/N#
	vPoisson<-(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB#
	VarBetween<-VarExcel-vPoisson #
	return(VarBetween)#
}
power.ddPCR.VB(delta=1.1,r=3,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1))#
power.ddPCR.VB(delta=1.1,r=4,N=12000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=2)#
power.ddPCR.VB(delta=1.1,r=5,N=10000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=3)#
power.ddPCR.VB(delta=1.1,r=6,N=8000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=4)
power.ddPCR.VB(delta=1.1,r=3,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1))#
power.ddPCR.VB(delta=1.1,r=4,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=2)#
power.ddPCR.VB(delta=1.1,r=5,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=3)#
power.ddPCR.VB(delta=1.1,r=6,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=4)
varCNV2<-function(N,NNegA,delta,r,VarExcel,NB) {#
	# This function calculates the variance of the CNV estimate based on r replicates#
	##
	# based on estimate of between replicate variance#
	# based on first order Taylor expansion#
	# delta: CNV under H1#
	# N: total number of droplets#
	# NNegA: number of negatives for the target#
	# r: number of replicates#
	# VarExcel: variance of r replicates calculated from Jo's Excel file#
	# NB: number of copies of reference species in genome#
	# we assume the covariance between the estimators of pA and pB is zero#
	##
	pA<-NNegA/N#
	pB<-pA^(1/delta)#
	VarPA<-pA*(1-pA)/N#
	VarPB<-pA^(1/delta)*(1-pA^(1/delta))/N#
	vPoisson<-(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB#
	VarBetween<-VarBetweenExcel(delta,VarExcel,NB)#
	if(VarBetween<0){VarBetween=0}#
	v<-(vPoisson+VarBetween)/r#
	return(v)#
}
power.ddPCR.VB(delta=1.1,r=3,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1))#
power.ddPCR.VB(delta=1.1,r=4,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=2)#
power.ddPCR.VB(delta=1.1,r=5,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=3)#
power.ddPCR.VB(delta=1.1,r=6,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=4)
VarBetween<-VarBetweenExcel(1.1,0.0031,2)
VarBetween
varCNV2<-function(N,NNegA,delta,r,VarExcel,NB) {#
	# This function calculates the variance of the CNV estimate based on r replicates#
	##
	# based on estimate of between replicate variance#
	# based on first order Taylor expansion#
	# delta: CNV under H1#
	# N: total number of droplets#
	# NNegA: number of negatives for the target#
	# r: number of replicates#
	# VarExcel: variance of r replicates calculated from Jo's Excel file#
	# NB: number of copies of reference species in genome#
	# we assume the covariance between the estimators of pA and pB is zero#
	##
	pA<-NNegA/N#
	pB<-pA^(1/delta)#
	VarPA<-pA*(1-pA)/N#
	VarPB<-pA^(1/delta)*(1-pA^(1/delta))/N#
	vPoisson<-(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB#
	VarBetween<-VarBetweenExcel(delta,VarExcel,NB,NNegA,N)#
	if(VarBetween<0){VarBetween=0}#
	v<-(vPoisson+VarBetween)/r#
	return(v)#
}
VarBetweenExcel<-function(delta,VarExcel,NB,NNegA,N) {#
	# This function computes the between-sample variance #
	# based on Jo's Excel file#
	##
	# delta: CNV under H1#
	# VarExcel: variance of r replicates calculated from Jo's Excel file#
	##
	# for a given delta	#
	pA<-NNegA/N#
	pB<-pA^(1/delta)#
	VarPA<-pA*(1-pA)/N#
	VarPB<-pA^(1/delta)*(1-pA^(1/delta))/N#
	vPoisson<-(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB#
	VarBetween<-VarExcel-vPoisson #
	return(VarBetween)#
}
VarBetween<-VarBetweenExcel(1.1,0.0031,2,2500,14000)
VarBetween
power.ddPCR.VB(delta=1.1,r=3,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1))#
power.ddPCR.VB(delta=1.1,r=4,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=2)#
power.ddPCR.VB(delta=1.1,r=5,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=3)#
power.ddPCR.VB(delta=1.1,r=6,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=4)
VarBetween
varCNV2<-function(N,NNegA,delta,r,VarExcel,NB) {#
	# This function calculates the variance of the CNV estimate based on r replicates#
	##
	# based on estimate of between replicate variance#
	# based on first order Taylor expansion#
	# delta: CNV under H1#
	# N: total number of droplets#
	# NNegA: number of negatives for the target#
	# r: number of replicates#
	# VarExcel: variance of r replicates calculated from Jo's Excel file#
	# NB: number of copies of reference species in genome#
	# we assume the covariance between the estimators of pA and pB is zero#
	##
	pA<-NNegA/N#
	pB<-pA^(1/delta)#
	VarPA<-pA*(1-pA)/N#
	VarPB<-pA^(1/delta)*(1-pA^(1/delta))/N#
	vPoisson<-(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB#
	VarBetween<-VarBetweenExcel(delta,VarExcel,NB,NNegA,N)#
	#if(VarBetween<0){VarBetween=0}#
	v<-(vPoisson+VarBetween)/r#
	return(v)#
}
power.ddPCR.VB(delta=1.1,r=3,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1))#
power.ddPCR.VB(delta=1.1,r=4,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=2)#
power.ddPCR.VB(delta=1.1,r=5,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=3)#
power.ddPCR.VB(delta=1.1,r=6,N=14000,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0,1),add=T,lty=4)
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
library(lmtest)#
library(randtests)#
library(sandwich)#
library(cowplot)#
source("powerFunCNV.R")#
server<-function(input, output)({#
#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
output$plotCNV <- renderPlot({#
	par(mfrow=c(3,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
power.ddPCR<-function(delta=1,r=3,NNeg.fr=0.2,NB=2,alpha=0.05,ylim=c(0.5,1),Nmin=5000,Nmax=20000,interrep=0.0031,add=F,lty=1,alternative="Two-sided") {#
	# This function computes and plots the power for testing H0: CNV=1 against H1: CNV=delta#
	# as a function of the total number of droplets#
	##
	# delta: CNV under H1#
	# NNegA.fr: fraction of negatives for the reference (fraction of total number of droplets)#
	# r: number of replicates#
	# NB: number of copies of reference species in genome	 #
	# alpha: significance level (one-sided)#
	# add=F: add=T --> line added to existing graph#
	# lty=1: line type to be used for plotting#
	##
	delta=delta+1#
	N<-seq(Nmin,Nmax,by=(Nmax-Nmin)/1000) # sequence of total number of droplets for which the power will be calculated#
	sd.CNV<-sapply(N,function(n,NNegA.fr,delta,NB) {#
		sqrt(varCNV2(n,NNegA=n*NNegA.fr,delta=delta,r=r,VarExcel=interrep,NB=NB))}, NNegA.fr=NNeg.fr,delta=delta,NB=NB)#
	if(alternative=="Greater"){#
		pwr<-(1-pnorm(qnorm(1-alpha)-(delta-1)/sd.CNV))#
	} else if(alternative=="Less"){#
		pwr<-(pnorm(qnorm(alpha)-(delta-1)/sd.CNV))#
	} else {#
		pwr<-(1-pnorm(qnorm(1-alpha/2)-(delta-1)/sd.CNV)+pnorm(qnorm(alpha/2)-(delta-1)/sd.CNV))#
	}#
	if(add) {#
		lines(N,pwr,lty=lty)#
	}#
	else {#
		plot(N,pwr,xlab="Total number of partitions",ylab="Power",type="l",main="",ylim=ylim,lty=lty)#
	}#
}
shinyApp(ui,server)
power.ddpCR(delta=0.1)
power.ddpCRrdelta=0.1)
#install.packages("shiny")#
#install.packages("shinydashboard")#
#install.packages("rhandsontable")#
#install.packages("shinyBS")#
#install.packages("rmarkdown")#
#install.packages("ggplot2")#
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
#
numSamples<-20#
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
   	 	menuItem("Between-replicate variation", tabName = "interrep", icon = icon("question-circle"),	#
     	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# ABS#
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitions","Number of partitions",value="10000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="0.1"),#
				textInput("Vp","Partition volume",value="1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				selectInput("Alt","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.05"),#
				textInput("maxeffect", "Maximal effect size", value="0.2"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textABS"),#
				plotOutput("plotABS",height="1000px")#
#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsREL","Number of partitions",value="15000"),#
				textInput("replicatesREL","Number of replicates",value="3"),#
				textInput("interrepREL","Between-replicate variation",value="0.001"),#
				textInput("effectREL","Effect size",value="0.1"),#
				sliderInput("fractionREL", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceREL", "Significance level", 0, 0.1, 0.05),#
				textInput("NBREL","Expected relative quantity",value="1"),#
				selectInput("AltREL","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartREL","Minimum number of partitions",value="1000"),#
				textInput("maxpartREL","Maximum number of partitions",value="20000"),#
				textInput("minrepREL","Minimum number of replicates",value="2"),#
				textInput("maxrepREL","Maximum number of replicates",value="10"),#
				textInput("mineffectREL", "Minimal effect size", value="0.05"),#
				textInput("maxeffectREL", "Maximal effect size", value="0.2"),#
				textInput("minreplREL", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplREL", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textREL"),#
				plotOutput("plotREL",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Expected number of copies",value="2"),#
				selectInput("AltCNV","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.05"),#
				textInput("maxeffectCNV", "Maximal effect size", value="0.2"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textCNV"),#
				plotOutput("plotCNV",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "interrep",#
    	box(#
#
		 	h2("Calculate between-replicate variation"),#
		 	sliderInput("significanceCNV", "Number of samples", 2, 100, 10),#
			rHandsontableOutput("hot"),#
			actionButton("calcInterrepABS", "Calculate")		 	      #
      	)#
    ),	#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
#install.packages("shiny")#
#install.packages("shinydashboard")#
#install.packages("rhandsontable")#
#install.packages("shinyBS")#
#install.packages("rmarkdown")#
#install.packages("ggplot2")#
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
#
numSamples<-20#
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
   	 	menuItem("Between-replicate variation", tabName = "interrep", icon = icon("question-circle")),	#
     	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# ABS#
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitions","Number of partitions",value="10000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="0.1"),#
				textInput("Vp","Partition volume",value="1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				selectInput("Alt","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.05"),#
				textInput("maxeffect", "Maximal effect size", value="0.2"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textABS"),#
				plotOutput("plotABS",height="1000px")#
#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsREL","Number of partitions",value="15000"),#
				textInput("replicatesREL","Number of replicates",value="3"),#
				textInput("interrepREL","Between-replicate variation",value="0.001"),#
				textInput("effectREL","Effect size",value="0.1"),#
				sliderInput("fractionREL", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceREL", "Significance level", 0, 0.1, 0.05),#
				textInput("NBREL","Expected relative quantity",value="1"),#
				selectInput("AltREL","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartREL","Minimum number of partitions",value="1000"),#
				textInput("maxpartREL","Maximum number of partitions",value="20000"),#
				textInput("minrepREL","Minimum number of replicates",value="2"),#
				textInput("maxrepREL","Maximum number of replicates",value="10"),#
				textInput("mineffectREL", "Minimal effect size", value="0.05"),#
				textInput("maxeffectREL", "Maximal effect size", value="0.2"),#
				textInput("minreplREL", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplREL", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textREL"),#
				plotOutput("plotREL",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Expected number of copies",value="2"),#
				selectInput("AltCNV","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.05"),#
				textInput("maxeffectCNV", "Maximal effect size", value="0.2"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textCNV"),#
				plotOutput("plotCNV",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "interrep",#
    	box(#
#
		 	h2("Calculate between-replicate variation"),#
		 	sliderInput("significanceCNV", "Number of samples", 2, 100, 10),#
			rHandsontableOutput("hot"),#
			actionButton("calcInterrepABS", "Calculate")		 	      #
      	)#
    ),	#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
source("powerFunCNV.R")#
source("powerFunABS.R")#
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
source("powerFunABS.R")
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
source("powerFunCNV.R")#
source("powerFunABS.R")#
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
## Handsontable#
observe({#
	if (!is.null(input$hot)) {#
		DF = hot_to_r(input$hot)#
	} else {#
		if (is.null(values[["DF"]]))#
		DF <- DF#
	else#
		DF <- values[["DF"]]#
	}#
	values[["DF"]] <- DF#
})#
#
output$hot <- renderRHandsontable({#
	DF <- values[["DF"]]#
	if (!is.null(DF))#
		rhandsontable(DF)#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
numSamples<-2
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
source("powerFunCNV.R")#
source("powerFunABS.R")#
numSamples<-2#
#
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
numSamples<-5#
#
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
#install.packages("shiny")#
#install.packages("shinydashboard")#
#install.packages("rhandsontable")#
#install.packages("shinyBS")#
#install.packages("rmarkdown")#
#install.packages("ggplot2")#
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
#
numSamples<-20#
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
   	 	menuItem("Between-replicate variation", tabName = "interrep", icon = icon("question-circle")),	#
     	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# ABS#
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitions","Number of partitions",value="10000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="0.1"),#
				textInput("Vp","Partition volume",value="1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				selectInput("Alt","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.05"),#
				textInput("maxeffect", "Maximal effect size", value="0.2"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textABS"),#
				plotOutput("plotABS",height="1000px")#
#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsREL","Number of partitions",value="15000"),#
				textInput("replicatesREL","Number of replicates",value="3"),#
				textInput("interrepREL","Between-replicate variation",value="0.001"),#
				textInput("effectREL","Effect size",value="0.1"),#
				sliderInput("fractionREL", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceREL", "Significance level", 0, 0.1, 0.05),#
				textInput("NBREL","Expected relative quantity",value="1"),#
				selectInput("AltREL","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartREL","Minimum number of partitions",value="1000"),#
				textInput("maxpartREL","Maximum number of partitions",value="20000"),#
				textInput("minrepREL","Minimum number of replicates",value="2"),#
				textInput("maxrepREL","Maximum number of replicates",value="10"),#
				textInput("mineffectREL", "Minimal effect size", value="0.05"),#
				textInput("maxeffectREL", "Maximal effect size", value="0.2"),#
				textInput("minreplREL", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplREL", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textREL"),#
				plotOutput("plotREL",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Expected number of copies",value="2"),#
				selectInput("AltCNV","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.05"),#
				textInput("maxeffectCNV", "Maximal effect size", value="0.2"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textCNV"),#
				plotOutput("plotCNV",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "interrep",#
    	box(#
#
		 	h2("Calculate between-replicate variation"),#
		 	sliderInput("nsample", "Number of samples", 2, 100, 5),#
			rHandsontableOutput("hot"),#
			actionButton("calcInterrepABS", "Calculate")		 	      #
      	)#
    ),	#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
shinyApp(ui,server)
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
   	 	menuItem("Between-replicate variation", tabName = "interrep", icon = icon("question-circle")),	#
     	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# ABS#
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitions","Number of partitions",value="10000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="0.1"),#
				textInput("Vp","Partition volume",value="1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				selectInput("Alt","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.05"),#
				textInput("maxeffect", "Maximal effect size", value="0.2"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textABS"),#
				plotOutput("plotABS",height="1000px")#
#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsREL","Number of partitions",value="15000"),#
				textInput("replicatesREL","Number of replicates",value="3"),#
				textInput("interrepREL","Between-replicate variation",value="0.001"),#
				textInput("effectREL","Effect size",value="0.1"),#
				sliderInput("fractionREL", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceREL", "Significance level", 0, 0.1, 0.05),#
				textInput("NBREL","Expected relative quantity",value="1"),#
				selectInput("AltREL","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartREL","Minimum number of partitions",value="1000"),#
				textInput("maxpartREL","Maximum number of partitions",value="20000"),#
				textInput("minrepREL","Minimum number of replicates",value="2"),#
				textInput("maxrepREL","Maximum number of replicates",value="10"),#
				textInput("mineffectREL", "Minimal effect size", value="0.05"),#
				textInput("maxeffectREL", "Maximal effect size", value="0.2"),#
				textInput("minreplREL", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplREL", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textREL"),#
				plotOutput("plotREL",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Expected number of copies",value="2"),#
				selectInput("AltCNV","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.05"),#
				textInput("maxeffectCNV", "Maximal effect size", value="0.2"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textCNV"),#
				plotOutput("plotCNV",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "interrep",#
    	fluidRow(box(#
#
		 	h2("Calculate between-replicate variation"),#
		 	sliderInput("nsample", "Number of samples", 2, 100, 5),#
			rHandsontableOutput("hot"),#
			HTML("<br>"),#
			actionButton("calcInterrepABS", "Calculate")		 	      #
      	)),#
#
	   fluidRow(#
			box(#
				textOutput("interrepABS"),#
			)      	#
    ),	#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
#install.packages("shiny")#
#install.packages("shinydashboard")#
#install.packages("rhandsontable")#
#install.packages("shinyBS")#
#install.packages("rmarkdown")#
#install.packages("ggplot2")#
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
#
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
   	 	menuItem("Between-replicate variation", tabName = "interrep", icon = icon("question-circle")),	#
     	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# ABS#
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitions","Number of partitions",value="10000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="0.1"),#
				textInput("Vp","Partition volume",value="1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				selectInput("Alt","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.05"),#
				textInput("maxeffect", "Maximal effect size", value="0.2"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textABS"),#
				plotOutput("plotABS",height="1000px")#
#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsREL","Number of partitions",value="15000"),#
				textInput("replicatesREL","Number of replicates",value="3"),#
				textInput("interrepREL","Between-replicate variation",value="0.001"),#
				textInput("effectREL","Effect size",value="0.1"),#
				sliderInput("fractionREL", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceREL", "Significance level", 0, 0.1, 0.05),#
				textInput("NBREL","Expected relative quantity",value="1"),#
				selectInput("AltREL","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartREL","Minimum number of partitions",value="1000"),#
				textInput("maxpartREL","Maximum number of partitions",value="20000"),#
				textInput("minrepREL","Minimum number of replicates",value="2"),#
				textInput("maxrepREL","Maximum number of replicates",value="10"),#
				textInput("mineffectREL", "Minimal effect size", value="0.05"),#
				textInput("maxeffectREL", "Maximal effect size", value="0.2"),#
				textInput("minreplREL", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplREL", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textREL"),#
				plotOutput("plotREL",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Expected number of copies",value="2"),#
				selectInput("AltCNV","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.05"),#
				textInput("maxeffectCNV", "Maximal effect size", value="0.2"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textCNV"),#
				plotOutput("plotCNV",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "interrep",#
    	fluidRow(box(#
#
		 	h2("Calculate between-replicate variation"),#
		 	sliderInput("nsample", "Number of samples", 2, 100, 5),#
			rHandsontableOutput("hot"),#
			HTML("<br>"),#
			actionButton("calcInterrepABS", "Calculate")		 	      #
      	)),#
#
	   fluidRow(#
			box(#
				textOutput("interrepABS"),#
			))      	#
    ),	#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
#install.packages("shiny")#
#install.packages("shinydashboard")#
#install.packages("rhandsontable")#
#install.packages("shinyBS")#
#install.packages("rmarkdown")#
#install.packages("ggplot2")#
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
#
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
   	 	menuItem("Between-replicate variation", tabName = "interrep", icon = icon("question-circle")),	#
     	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# ABS#
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitions","Number of partitions",value="10000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="0.1"),#
				textInput("Vp","Partition volume",value="1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				selectInput("Alt","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.05"),#
				textInput("maxeffect", "Maximal effect size", value="0.2"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textABS"),#
				plotOutput("plotABS",height="1000px")#
#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsREL","Number of partitions",value="15000"),#
				textInput("replicatesREL","Number of replicates",value="3"),#
				textInput("interrepREL","Between-replicate variation",value="0.001"),#
				textInput("effectREL","Effect size",value="0.1"),#
				sliderInput("fractionREL", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceREL", "Significance level", 0, 0.1, 0.05),#
				textInput("NBREL","Expected relative quantity",value="1"),#
				selectInput("AltREL","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartREL","Minimum number of partitions",value="1000"),#
				textInput("maxpartREL","Maximum number of partitions",value="20000"),#
				textInput("minrepREL","Minimum number of replicates",value="2"),#
				textInput("maxrepREL","Maximum number of replicates",value="10"),#
				textInput("mineffectREL", "Minimal effect size", value="0.05"),#
				textInput("maxeffectREL", "Maximal effect size", value="0.2"),#
				textInput("minreplREL", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplREL", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textREL"),#
				plotOutput("plotREL",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Expected number of copies",value="2"),#
				selectInput("AltCNV","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.05"),#
				textInput("maxeffectCNV", "Maximal effect size", value="0.2"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textCNV"),#
				plotOutput("plotCNV",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "interrep",#
		h2("Calculate between-replicate variation"),#
    	fluidRow(#
    		box(#
		 		sliderInput("nsample", "Number of samples", 2, 100, 5),#
				rHandsontableOutput("hot"),#
				HTML("<br>"),#
				actionButton("calcInterrepABS", "Calculate")		 	      #
      	)),#
	   fluidRow(#
			box(#
				textOutput("interrepABS"),#
			))      	#
    ),	#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
#install.packages("shiny")#
#install.packages("shinydashboard")#
#install.packages("rhandsontable")#
#install.packages("shinyBS")#
#install.packages("rmarkdown")#
#install.packages("ggplot2")#
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
#
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
   	 	menuItem("Between-replicate variation", tabName = "interrep", icon = icon("question-circle")),	#
     	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# ABS#
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitions","Number of partitions",value="10000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="0.1"),#
				textInput("Vp","Partition volume",value="1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				selectInput("Alt","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.05"),#
				textInput("maxeffect", "Maximal effect size", value="0.2"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textABS"),#
				plotOutput("plotABS",height="1000px")#
#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsREL","Number of partitions",value="15000"),#
				textInput("replicatesREL","Number of replicates",value="3"),#
				textInput("interrepREL","Between-replicate variation",value="0.001"),#
				textInput("effectREL","Effect size",value="0.1"),#
				sliderInput("fractionREL", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceREL", "Significance level", 0, 0.1, 0.05),#
				textInput("NBREL","Expected relative quantity",value="1"),#
				selectInput("AltREL","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartREL","Minimum number of partitions",value="1000"),#
				textInput("maxpartREL","Maximum number of partitions",value="20000"),#
				textInput("minrepREL","Minimum number of replicates",value="2"),#
				textInput("maxrepREL","Maximum number of replicates",value="10"),#
				textInput("mineffectREL", "Minimal effect size", value="0.05"),#
				textInput("maxeffectREL", "Maximal effect size", value="0.2"),#
				textInput("minreplREL", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplREL", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textREL"),#
				plotOutput("plotREL",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Expected number of copies",value="2"),#
				selectInput("AltCNV","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.05"),#
				textInput("maxeffectCNV", "Maximal effect size", value="0.2"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textCNV"),#
				plotOutput("plotCNV",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "interrep",#
		h2("Calculate between-replicate variation"),#
    	fluidRow(#
    		box(title="",#
		 		sliderInput("nsample", "Number of samples", 2, 100, 5),#
				rHandsontableOutput("hot"),#
				HTML("<br>"),#
				actionButton("calcInterrepABS", "Calculate")		 	      #
      	)),#
	   fluidRow(#
			box(title="",#
				textOutput("interrepABS"),#
			))      	#
    ),	#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
#install.packages("shiny")#
#install.packages("shinydashboard")#
#install.packages("rhandsontable")#
#install.packages("shinyBS")#
#install.packages("rmarkdown")#
#install.packages("ggplot2")#
library(rhandsontable)#
library(shinydashboard)#
library(shinyBS)#
library(shiny)#
library(ggplot2)#
library(rmarkdown)#
#
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
   	 	menuItem("Between-replicate variation", tabName = "interrep", icon = icon("question-circle")),	#
     	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# ABS#
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitions","Number of partitions",value="10000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="0.1"),#
				textInput("Vp","Partition volume",value="1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				selectInput("Alt","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.05"),#
				textInput("maxeffect", "Maximal effect size", value="0.2"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textABS"),#
				plotOutput("plotABS",height="1000px")#
#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsREL","Number of partitions",value="15000"),#
				textInput("replicatesREL","Number of replicates",value="3"),#
				textInput("interrepREL","Between-replicate variation",value="0.001"),#
				textInput("effectREL","Effect size",value="0.1"),#
				sliderInput("fractionREL", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceREL", "Significance level", 0, 0.1, 0.05),#
				textInput("NBREL","Expected relative quantity",value="1"),#
				selectInput("AltREL","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartREL","Minimum number of partitions",value="1000"),#
				textInput("maxpartREL","Maximum number of partitions",value="20000"),#
				textInput("minrepREL","Minimum number of replicates",value="2"),#
				textInput("maxrepREL","Maximum number of replicates",value="10"),#
				textInput("mineffectREL", "Minimal effect size", value="0.05"),#
				textInput("maxeffectREL", "Maximal effect size", value="0.2"),#
				textInput("minreplREL", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplREL", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textREL"),#
				plotOutput("plotREL",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Expected number of copies",value="2"),#
				selectInput("AltCNV","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.05"),#
				textInput("maxeffectCNV", "Maximal effect size", value="0.2"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textCNV"),#
				plotOutput("plotCNV",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "interrep",#
		h2("Calculate between-replicate variation"),#
    	fluidRow(#
    		box(title="",#
		 		sliderInput("nsample", "Number of samples", 2, 100, 5),#
				rHandsontableOutput("hot"),#
				HTML("<br>"),#
				actionButton("calcInterrepABS", "Calculate")		 	      #
      	)),#
	   fluidRow(#
			box(title="",#
				textOutput("interrepABS")#
			))      	#
    ),	#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
paramsABS <- eventReactive(input$calcInterrepABS,{#
		betweenrep <- 0#
	}#
)#
#
output$interrepABS <- renderText({#
	if(paramsABS$betweenrep<0){#
		paste0("There is no evidence for between-replicate.")#
	} else {#
		paste0("The between-replicate variation is: ", paramsABS$betweenrep, ".")#
	}#
})#
#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
paramsABS <- eventReactive(input$calcInterrepABS,{#
		list(betweenrep <- 0)#
	}#
)#
#
output$interrepABS <- renderText({#
	if(paramsABS[["betweenrep"]]<0){#
		paste0("There is no evidence for between-replicate.")#
	} else {#
		paste0("The between-replicate variation is: ", paramsABS[["betweenrep"]], ".")#
	}#
})#
#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarABS <- eventReactive(input$calcInterrepABS,{#
		list(betweenrep <- 0)#
	}#
)#
#
output$interrepABS <- renderText({#
	if(interrepvarABS()[["betweenrep"]]<0){#
		paste0("There is no evidence for between-replicate.")#
	} else {#
		paste0("The between-replicate variation is: ", interrepvarABS()[["betweenrep"]], ".")#
	}#
})#
#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarABS <- eventReactive(input$calcInterrepABS,{#
		list(betweenrep = 0)#
	}#
)#
#
output$interrepABS <- renderText({#
	if(interrepvarABS()[["betweenrep"]]<0){#
		paste0("There is no evidence for between-replicate.")#
	} else {#
		paste0("The between-replicate variation is: ", interrepvarABS()[["betweenrep"]], ".")#
	}#
})#
#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
   	 	menuItem("Between-replicate variation", tabName = "interrep", icon = icon("question-circle")),	#
     	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# ABS#
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitions","Number of partitions",value="10000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="0.1"),#
				textInput("Vp","Partition volume",value="1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				selectInput("Alt","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.05"),#
				textInput("maxeffect", "Maximal effect size", value="0.2"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textABS"),#
				plotOutput("plotABS",height="1000px")#
#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsREL","Number of partitions",value="15000"),#
				textInput("replicatesREL","Number of replicates",value="3"),#
				textInput("interrepREL","Between-replicate variation",value="0.001"),#
				textInput("effectREL","Effect size",value="0.1"),#
				sliderInput("fractionREL", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceREL", "Significance level", 0, 0.1, 0.05),#
				textInput("NBREL","Expected relative quantity",value="1"),#
				selectInput("AltREL","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartREL","Minimum number of partitions",value="1000"),#
				textInput("maxpartREL","Maximum number of partitions",value="20000"),#
				textInput("minrepREL","Minimum number of replicates",value="2"),#
				textInput("maxrepREL","Maximum number of replicates",value="10"),#
				textInput("mineffectREL", "Minimal effect size", value="0.05"),#
				textInput("maxeffectREL", "Maximal effect size", value="0.2"),#
				textInput("minreplREL", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplREL", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textREL"),#
				plotOutput("plotREL",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Expected number of copies",value="2"),#
				selectInput("AltCNV","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.05"),#
				textInput("maxeffectCNV", "Maximal effect size", value="0.2"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textCNV"),#
				plotOutput("plotCNV",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "interrep",#
		h2("Calculate between-replicate variation"),#
    	fluidRow(#
    		box(#
		 		sliderInput("nsample", "Number of samples", 2, 100, 5),#
				rHandsontableOutput("hot"),#
				HTML("<br>"),#
				actionButton("calcInterrepABS", "Calculate")		 	      #
      	)),#
	   fluidRow(#
			box(#
				textOutput("interrepABS")#
			))      	#
    ),	#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
shinyApp(ui,server)
var(rnorm(100,0,1))
var(rnorm(10000,0,1))
var(rnorm(10000,0,1)/2)
varBetween <- function(N,Npos,Vp){#
	VarTotal<-var(-log(1-Npos/N)/Vp)#
	NposA <- mean(Npos)#
	N <- mean(N)#
	pA<-1-NposA/N#
	VarPA<-pA*(1-pA)/N#
	vPoisson<-VarPA/(pA*Vp)^2#
	v<-VarTotal-vPoisson#
	return(v)	#
}
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarABS <- eventReactive(input$calcInterrepABS,{#
		data.interrep <- as.data.frame(values$data)#
		betweenrep <- varBetween(data.interrep[,2], data.interrep[,1], input$VpInterrep)#
		list(betweenrep = betweenrep)#
	}#
)#
#
output$interrepABS <- renderText({#
	if(interrepvarABS()[["betweenrep"]]<0){#
		paste0("There is no evidence for between-replicate.")#
	} else {#
		paste0("The between-replicate variation is: ", interrepvarABS()[["betweenrep"]], ".")#
	}#
})#
#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
   	 	menuItem("Between-replicate variation", tabName = "interrep", icon = icon("question-circle")),	#
     	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# ABS#
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitions","Number of partitions",value="10000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="0.1"),#
				textInput("Vp","Partition volume",value="1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				selectInput("Alt","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.05"),#
				textInput("maxeffect", "Maximal effect size", value="0.2"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textABS"),#
				plotOutput("plotABS",height="1000px")#
#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsREL","Number of partitions",value="15000"),#
				textInput("replicatesREL","Number of replicates",value="3"),#
				textInput("interrepREL","Between-replicate variation",value="0.001"),#
				textInput("effectREL","Effect size",value="0.1"),#
				sliderInput("fractionREL", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceREL", "Significance level", 0, 0.1, 0.05),#
				textInput("NBREL","Expected relative quantity",value="1"),#
				selectInput("AltREL","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartREL","Minimum number of partitions",value="1000"),#
				textInput("maxpartREL","Maximum number of partitions",value="20000"),#
				textInput("minrepREL","Minimum number of replicates",value="2"),#
				textInput("maxrepREL","Maximum number of replicates",value="10"),#
				textInput("mineffectREL", "Minimal effect size", value="0.05"),#
				textInput("maxeffectREL", "Maximal effect size", value="0.2"),#
				textInput("minreplREL", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplREL", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textREL"),#
				plotOutput("plotREL",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Expected number of copies",value="2"),#
				selectInput("AltCNV","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.05"),#
				textInput("maxeffectCNV", "Maximal effect size", value="0.2"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textCNV"),#
				plotOutput("plotCNV",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "interrep",#
		h2("Calculate between-replicate variation"),#
    	fluidRow(#
    		box(#
		 		sliderInput("nsample", "Number of samples", 2, 100, 5),#
		 		textInput("interrepVp","Partition volume", "1"),#
				rHandsontableOutput("hot"),#
				HTML("<br>"),#
				actionButton("calcInterrepABS", "Calculate")		 	      #
      	)),#
	   fluidRow(#
			box(#
				textOutput("interrepABS")#
			))      	#
    ),	#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarABS <- eventReactive(input$calcInterrepABS,{#
		list(data = values$data,Vp=as.numeric(input$interrepVp))#
	}#
)#
#
output$interrepABS <- renderText({#
	data.interrep <- as.data.frame(interrepvarABS()[["data"]])#
	betweenrep <- varBetween(data.interrep[,2], data.interrep[,1], interrepvarABS()[["Vp"]])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
varBetween(c(0,0),c(0,0),1)
varBetween <- function(N,Npos,Vp){#
	VarTotal<-var(-log(1-Npos/N)/Vp)#
	NposA <- mean(Npos)#
	N <- mean(N)#
	pA<-1-NposA/N#
	VarPA<-pA*(1-pA)/N#
	vPoisson<-VarPA/(pA*Vp)^2#
	v<-VarTotal-vPoisson#
	if(is.na(v)){ v <- -1}#
	return(v)	#
}
varBetween(c(0,0),c(0,0),1)
shinyApp(ui,server)
?hot_col
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
   	 	menuItem("Between-replicate variation", tabName = "interrep", icon = icon("question-circle")),	#
   	 	menuItem("Between-replicate variation", tabName = "interrepCNV", icon = icon("question-circle")),	#
       	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# ABS#
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitions","Number of partitions",value="10000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="0.1"),#
				textInput("Vp","Partition volume",value="1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				selectInput("Alt","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.05"),#
				textInput("maxeffect", "Maximal effect size", value="0.2"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textABS"),#
				plotOutput("plotABS",height="1000px")#
#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsREL","Number of partitions",value="15000"),#
				textInput("replicatesREL","Number of replicates",value="3"),#
				textInput("interrepREL","Between-replicate variation",value="0.001"),#
				textInput("effectREL","Effect size",value="0.1"),#
				sliderInput("fractionREL", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceREL", "Significance level", 0, 0.1, 0.05),#
				textInput("NBREL","Expected relative quantity",value="1"),#
				selectInput("AltREL","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartREL","Minimum number of partitions",value="1000"),#
				textInput("maxpartREL","Maximum number of partitions",value="20000"),#
				textInput("minrepREL","Minimum number of replicates",value="2"),#
				textInput("maxrepREL","Maximum number of replicates",value="10"),#
				textInput("mineffectREL", "Minimal effect size", value="0.05"),#
				textInput("maxeffectREL", "Maximal effect size", value="0.2"),#
				textInput("minreplREL", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplREL", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textREL"),#
				plotOutput("plotREL",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Expected number of copies",value="2"),#
				selectInput("AltCNV","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.05"),#
				textInput("maxeffectCNV", "Maximal effect size", value="0.2"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textCNV"),#
				plotOutput("plotCNV",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "interrep",#
		h2("Calculate between-replicate variation"),#
    	fluidRow(#
    		box(#
		 		sliderInput("nsample", "Number of samples", 2, 100, 5),#
		 		textInput("interrepVp","Partition volume", "1"),#
				rHandsontableOutput("hot"),#
				HTML("<br>"),#
				actionButton("calcInterrepABS", "Calculate")		 	      #
      	)),#
	   fluidRow(#
			box(#
				textOutput("interrepABS")#
			))      	#
    ),	#
	tabItem(tabName = "interrepCNV",#
		h2("Calculate between-replicate variation"),#
    	fluidRow(#
    		box(#
		 		sliderInput("nsample", "Number of samples", 2, 100, 5),#
		 		#textInput("interrepVp","Partition volume", "1"),#
				rHandsontableOutput("hot"),#
				HTML("<br>"),#
				actionButton("calcInterrepCNV", "Calculate")		 	      #
      	)),#
	   fluidRow(#
			box(#
				textOutput("interrepABS")#
			))      	#
    ),		#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
shinyApp(ui,server)
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
   	 	menuItem("Between-replicate variation", tabName = "interrep", icon = icon("question-circle")),	#
   	 	menuItem("Between-replicate variation", tabName = "interrepCNV", icon = icon("question-circle")),	#
       	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# ABS#
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitions","Number of partitions",value="10000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="0.1"),#
				textInput("Vp","Partition volume",value="1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				selectInput("Alt","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.05"),#
				textInput("maxeffect", "Maximal effect size", value="0.2"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textABS"),#
				plotOutput("plotABS",height="1000px")#
#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsREL","Number of partitions",value="15000"),#
				textInput("replicatesREL","Number of replicates",value="3"),#
				textInput("interrepREL","Between-replicate variation",value="0.001"),#
				textInput("effectREL","Effect size",value="0.1"),#
				sliderInput("fractionREL", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceREL", "Significance level", 0, 0.1, 0.05),#
				textInput("NBREL","Expected relative quantity",value="1"),#
				selectInput("AltREL","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartREL","Minimum number of partitions",value="1000"),#
				textInput("maxpartREL","Maximum number of partitions",value="20000"),#
				textInput("minrepREL","Minimum number of replicates",value="2"),#
				textInput("maxrepREL","Maximum number of replicates",value="10"),#
				textInput("mineffectREL", "Minimal effect size", value="0.05"),#
				textInput("maxeffectREL", "Maximal effect size", value="0.2"),#
				textInput("minreplREL", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplREL", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textREL"),#
				plotOutput("plotREL",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Expected number of copies",value="2"),#
				selectInput("AltCNV","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.05"),#
				textInput("maxeffectCNV", "Maximal effect size", value="0.2"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textCNV"),#
				plotOutput("plotCNV",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "interrep",#
		h2("Calculate between-replicate variation"),#
    	fluidRow(#
    		box(#
		 		sliderInput("nsample", "Number of samples", 2, 100, 5),#
		 		textInput("interrepVp","Partition volume", "1"),#
				rHandsontableOutput("hot"),#
				HTML("<br>"),#
				actionButton("calcInterrepABS", "Calculate")		 	      #
      	)),#
	   fluidRow(#
			box(#
				textOutput("interrepABS")#
			))      	#
    ),	#
	tabItem(tabName = "interrepCNV",#
		h2("Calculate between-replicate variation"),#
    	fluidRow(#
    		box(#
		 		sliderInput("nsample", "Number of samples", 2, 100, 5),#
		 		#textInput("interrepVp","Partition volume", "1"),#
				rHandsontableOutput("hotCNV"),#
				HTML("<br>"),#
				actionButton("calcInterrepCNV", "Calculate")		 	      #
      	)),#
	   fluidRow(#
			box(#
				textOutput("interrepABS")#
			))      	#
    ),		#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
shinyApp(ui,server)
ui<-shinyUI(dashboardPage(#
    skin="red",#
	dashboardHeader(title = "dPowerCalcR"),#
	dashboardSidebar(#
	sidebarMenu(#
    	menuItem("Power calculation", tabName = "power", icon = icon("question-circle"),#
    		menuSubItem("Absolute quantification", tabName = "abs"),#
   	 		menuSubItem("Relative quantification", tabName = "rel"),#
   	 		menuSubItem("Copy number variation", tabName = "cnv")),#
   	 	menuItem("Between-replicate variation", tabName = "interrep", icon = icon("question-circle")),	#
   	 	menuItem("Between-replicate variation", tabName = "interrepCNV", icon = icon("question-circle")),	#
       	menuItem("Help", tabName = "help", icon = icon("question-circle"),#
    		menuSubItem("Citation", tabName = "cite"),#
   	 		menuSubItem("FAQ", tabName = "faq"))#
    )#
#
),#
dashboardBody(#
	tabItems(#
#
	#################################
	# ABS#
	#################################
#
    tabItem(tabName = "abs",#
    	h2("Power calculation for absolute quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitions","Number of partitions",value="10000"),#
				textInput("replicates","Number of replicates",value="3"),#
				textInput("interrep","Between-replicate variation",value="0.001"),#
				textInput("effect","Effect size",value="0.1"),#
				textInput("Vp","Partition volume",value="1"),#
				sliderInput("fraction", "Fraction of negatives", 0, 1, 0.2),#
				sliderInput("significance", "Significance level", 0, 0.1, 0.05),#
				selectInput("Alt","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsABS", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpart","Minimum number of partitions",value="1000"),#
				textInput("maxpart","Maximum number of partitions",value="20000"),#
				textInput("minrep","Minimum number of replicates",value="2"),#
				textInput("maxrep","Maximum number of replicates",value="10"),#
				textInput("mineffect", "Minimal effect size", value="0.05"),#
				textInput("maxeffect", "Maximal effect size", value="0.2"),#
				textInput("minrepl", "Minimal between-replicate variation", value="0"),#
				textInput("maxrepl", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textABS"),#
				plotOutput("plotABS",height="1000px")#
#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateABS","Generate report")#
    	)      #
      )#
	),#
	#################################
	# REL QUANT #
	#################################
	tabItem(tabName = "rel",#
    	h2("Power calculation for relative quantification"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsREL","Number of partitions",value="15000"),#
				textInput("replicatesREL","Number of replicates",value="3"),#
				textInput("interrepREL","Between-replicate variation",value="0.001"),#
				textInput("effectREL","Effect size",value="0.1"),#
				sliderInput("fractionREL", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceREL", "Significance level", 0, 0.1, 0.05),#
				textInput("NBREL","Expected relative quantity",value="1"),#
				selectInput("AltREL","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsREL", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartREL","Minimum number of partitions",value="1000"),#
				textInput("maxpartREL","Maximum number of partitions",value="20000"),#
				textInput("minrepREL","Minimum number of replicates",value="2"),#
				textInput("maxrepREL","Maximum number of replicates",value="10"),#
				textInput("mineffectREL", "Minimal effect size", value="0.05"),#
				textInput("maxeffectREL", "Maximal effect size", value="0.2"),#
				textInput("minreplREL", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplREL", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textREL"),#
				plotOutput("plotREL",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateREL","Generate report")#
    	)      #
      )#
	),#
	#################################
	# COPY NUMBER #
	#################################
	tabItem(tabName = "cnv",#
    	h2("Power calculation for copy number variation"),#
		fluidRow(#
			box(#
				#HTML("<hr>"),#
				title="Power parameters",#
				width=6,#
				height=770,#
				textInput("partitionsCNV","Number of partitions",value="15000"),#
				textInput("replicatesCNV","Number of replicates",value="3"),#
				textInput("interrepCNV","Between-replicate variation",value="0.001"),#
				textInput("effectCNV","Effect size",value="0.1"),#
				sliderInput("fractionCNV", "Fraction of negatives for target", 0, 1, 0.2),#
				sliderInput("significanceCNV", "Significance level", 0, 0.1, 0.05),#
				textInput("NB","Expected number of copies",value="2"),#
				selectInput("AltCNV","Hypothesis",choices=c("Two-sided","Less","Greater")),#
				HTML("<br>"),#
				actionButton("calcResultsCNV", "Calculate")				#
			),#
			box(#
				title="Plot parameters",#
				width=6,#
				height=770,#
				textInput("minpartCNV","Minimum number of partitions",value="1000"),#
				textInput("maxpartCNV","Maximum number of partitions",value="20000"),#
				textInput("minrepCNV","Minimum number of replicates",value="2"),#
				textInput("maxrepCNV","Maximum number of replicates",value="10"),#
				textInput("mineffectCNV", "Minimal effect size", value="0.05"),#
				textInput("maxeffectCNV", "Maximal effect size", value="0.2"),#
				textInput("minreplCNV", "Minimal between-replicate variation", value="0"),#
				textInput("maxreplCNV", "Maximal between-replicate variation", value="0.01")#
			)#
	   ),#
	   fluidRow(#
			box(#
				title="Results",width=12,#
				textOutput("textCNV"),#
				plotOutput("plotCNV",height="1000px")#
			)#
		),#
	   fluidRow(#
			box(title="Generate report",width=12,#
	        	textInput("reportTitle","Title of the report",value="dPCR design report"),#
	        	radioButtons('format', 'Document format', c('PDF'), inline = TRUE),#
	        	downloadButton("reportGenerateCNV","Generate report")#
    	)      #
      )#
	),	#
	tabItem(tabName = "interrep",#
		h2("Calculate between-replicate variation"),#
    	fluidRow(#
    		box(#
		 		sliderInput("nsample", "Number of samples", 2, 100, 5),#
		 		textInput("interrepVp","Partition volume", "1"),#
				rHandsontableOutput("hot"),#
				HTML("<br>"),#
				actionButton("calcInterrepABS", "Calculate")		 	      #
      	)),#
	   fluidRow(#
			box(#
				textOutput("interrepABS")#
			))      	#
    ),	#
	tabItem(tabName = "interrepCNV",#
		h2("Calculate between-replicate variation"),#
    	fluidRow(#
    		box(#
		 		sliderInput("nsampleCNV", "Number of samples", 2, 100, 5),#
		 		#textInput("interrepVp","Partition volume", "1"),#
				rHandsontableOutput("hotCNV"),#
				HTML("<br>"),#
				actionButton("calcInterrepCNV", "Calculate")		 	      #
      	)),#
	   fluidRow(#
			box(#
				textOutput("interrepCNV")#
			))      	#
    ),		#
	tabItem(tabName = "cite",#
    	box(#
#
		 	h4("Citation"),#
		 	p("When using this application to design your dPCR experiments, please cite:"),#
		 	p("Vynck, M. et al. (2018). On the design of digital PCR experiments."),#
		 	p("Full text available at ..."),#
		 	p("More information on digital PCR data analysis on http://dpcr.ugent.be.")		 	      #
      	)#
    ),#
    tabItem(tabName = "faq",#
    	box(#
			h4("Where can I find the underlying methodology?"),#
			p("The full text of our paper is available at ..."),#
		 	h4("Questions? Feel free to contact me at Matthijs.Vynck@UGent.be.")#
      	)#
	)#
  )#
)#
)#
)
shinyApp(ui,server)
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarABS <- eventReactive(input$calcInterrepABS,{#
		list(data = values$data,Vp=as.numeric(input$interrepVp))#
	}#
)#
#
output$interrepABS <- renderText({#
	data.interrep <- as.data.frame(interrepvarABS()[["data"]])#
	betweenrep <- varBetween(data.interrep[,2], data.interrep[,1], interrepvarABS()[["Vp"]])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
valuesCNV <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples*2))), Total = c(rep(0,(numSamples*2)))), Target = c(rep(TRUE,numSamples),rep(FALSE,numSamples)))#
#
adjust.dataCNV <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsampleCNV*2){#
		df_[(n+1):input$nsampleCNV*2,1]<-0#
  		df_[(n+1):input$nsampleCNV*2,2]<-0#
  		df_[1:input$nsampleCNV,3]<-TRUE#
  		df_[(input$nsampleCNV+1):input$nsampleCNV*2,3]<-FALSE#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsampleCNV,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    df_$Target<-as.logical(df_$Target)#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
})#
#
observeEvent(input$nsampleCNV,({#
	if(!is.null(input$hot)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
  	valuesCNV$data<-adjust.data(valuesCNV$data)#
})#
)#
output$hotCNV <- renderRHandsontable({#
        rhandsontable(valuesCNV$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarCNV <- eventReactive(input$calcInterrepCNV,{#
		list(data = valuesCNV$data)#
	}#
)#
#
output$interrepCNV <- renderText({#
	data.interrep <- as.data.frame(interrepvarCNV()[["data"]])#
	betweenrep <- varBetweenCNV(data.interrep[,2], data.interrep[,1])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
?hot_col
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarABS <- eventReactive(input$calcInterrepABS,{#
		list(data = values$data,Vp=as.numeric(input$interrepVp))#
	}#
)#
#
output$interrepABS <- renderText({#
	data.interrep <- as.data.frame(interrepvarABS()[["data"]])#
	betweenrep <- varBetween(data.interrep[,2], data.interrep[,1], interrepvarABS()[["Vp"]])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
valuesCNV <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples*2))), Total = c(rep(0,(numSamples*2))), Target = c(rep(TRUE,numSamples),rep(FALSE,numSamples)), stringsAsFactors=FALSE))#
#
adjust.dataCNV <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsampleCNV*2){#
		df_[(n+1):input$nsampleCNV*2,1]<-0#
  		df_[(n+1):input$nsampleCNV*2,2]<-0#
  		df_[1:input$nsampleCNV,3]<-TRUE#
  		df_[(input$nsampleCNV+1):input$nsampleCNV*2,3]<-FALSE#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsampleCNV,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    df_$Target<-as.logical(df_$Target)#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
})#
#
observeEvent(input$nsampleCNV,({#
	if(!is.null(input$hot)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
  	valuesCNV$data<-adjust.data(valuesCNV$data)#
})#
)#
output$hotCNV <- renderRHandsontable({#
        rhandsontable(valuesCNV$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0") %>%#
  			hot_col("Target")#
})   #
interrepvarCNV <- eventReactive(input$calcInterrepCNV,{#
		list(data = valuesCNV$data)#
	}#
)#
#
output$interrepCNV <- renderText({#
	data.interrep <- as.data.frame(interrepvarCNV()[["data"]])#
	betweenrep <- varBetweenCNV(data.interrep[,2], data.interrep[,1])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
data=data.frame(Positives = c(rep(0,(numSamples*2))), Total = c(rep(0,(numSamples*2))), Target = c(rep(TRUE,numSamples),rep(FALSE,numSamples)), stringsAsFactors=FALSE)
data
numSamples<-5#
#
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarABS <- eventReactive(input$calcInterrepABS,{#
		list(data = values$data,Vp=as.numeric(input$interrepVp))#
	}#
)#
#
output$interrepABS <- renderText({#
	data.interrep <- as.data.frame(interrepvarABS()[["data"]])#
	betweenrep <- varBetween(data.interrep[,2], data.interrep[,1], interrepvarABS()[["Vp"]])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
valuesCNV <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples*2))), Total = c(rep(0,(numSamples*2))), Target = c(rep(TRUE,numSamples),rep(FALSE,numSamples)), stringsAsFactors=FALSE))#
#
adjust.dataCNV <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsampleCNV*2){#
		df_[(n+1):input$nsampleCNV*2,1]<-0#
  		df_[(n+1):input$nsampleCNV*2,2]<-0#
  		df_[1:input$nsampleCNV,3]<-TRUE#
  		df_[(input$nsampleCNV+1):input$nsampleCNV*2,3]<-FALSE#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsampleCNV*2,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    df_$Target<-as.logical(df_$Target)#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
})#
#
observeEvent(input$nsampleCNV,({#
	if(!is.null(input$hot)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
  	valuesCNV$data<-adjust.data(valuesCNV$data)#
})#
)#
output$hotCNV <- renderRHandsontable({#
        rhandsontable(valuesCNV$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0") %>%#
  			hot_col("Target")#
})   #
interrepvarCNV <- eventReactive(input$calcInterrepCNV,{#
		list(data = valuesCNV$data)#
	}#
)#
#
output$interrepCNV <- renderText({#
	data.interrep <- as.data.frame(interrepvarCNV()[["data"]])#
	betweenrep <- varBetweenCNV(data.interrep[,2], data.interrep[,1])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
numSamples<-5#
#
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarABS <- eventReactive(input$calcInterrepABS,{#
		list(data = values$data,Vp=as.numeric(input$interrepVp))#
	}#
)#
#
output$interrepABS <- renderText({#
	data.interrep <- as.data.frame(interrepvarABS()[["data"]])#
	betweenrep <- varBetween(data.interrep[,2], data.interrep[,1], interrepvarABS()[["Vp"]])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
valuesCNV <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples*2))), Total = c(rep(0,(numSamples*2))), Target = c(rep(TRUE,numSamples),rep(FALSE,numSamples)), stringsAsFactors=FALSE))#
#
adjust.dataCNV <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsampleCNV*2){#
		df_[(n+1):input$nsampleCNV*2,1]<-0#
  		df_[(n+1):input$nsampleCNV*2,2]<-0#
  		df_[1:input$nsampleCNV,3]<-TRUE#
  		df_[(input$nsampleCNV+1):input$nsampleCNV*2,3]<-FALSE#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsampleCNV*2,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    df_$Target<-as.logical(df_$Target)#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
})#
#
observeEvent(input$nsampleCNV,({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
  	valuesCNV$data<-adjust.data(valuesCNV$data)#
})#
)#
output$hotCNV <- renderRHandsontable({#
        rhandsontable(valuesCNV$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0") %>%#
  			hot_col("Target")#
})   #
interrepvarCNV <- eventReactive(input$calcInterrepCNV,{#
		list(data = valuesCNV$data)#
	}#
)#
#
output$interrepCNV <- renderText({#
	data.interrep <- as.data.frame(interrepvarCNV()[["data"]])#
	betweenrep <- varBetweenCNV(data.interrep[,2], data.interrep[,1])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
numSamples<-5#
#
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarABS <- eventReactive(input$calcInterrepABS,{#
		list(data = values$data,Vp=as.numeric(input$interrepVp))#
	}#
)#
#
output$interrepABS <- renderText({#
	data.interrep <- as.data.frame(interrepvarABS()[["data"]])#
	betweenrep <- varBetween(data.interrep[,2], data.interrep[,1], interrepvarABS()[["Vp"]])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
valuesCNV <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples*2))), Total = c(rep(0,(numSamples*2))), Target = c(rep(TRUE,numSamples),rep(FALSE,numSamples)), stringsAsFactors=FALSE))#
#
adjust.dataCNV <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsampleCNV*2){#
		df_[(n+1):input$nsampleCNV*2,1]<-0#
  		df_[(n+1):input$nsampleCNV*2,2]<-0#
  		df_[1:input$nsampleCNV,3]<-TRUE#
  		df_[(input$nsampleCNV+1):input$nsampleCNV*2,3]<-FALSE#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsampleCNV*2,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    df_$Target<-as.logical(df_$Target)#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
})#
#
observeEvent(input$nsampleCNV,({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
  	valuesCNV$data<-adjust.dataCNV(valuesCNV$data)#
})#
)#
output$hotCNV <- renderRHandsontable({#
        rhandsontable(valuesCNV$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0") %>%#
  			hot_col("Target")#
})   #
interrepvarCNV <- eventReactive(input$calcInterrepCNV,{#
		list(data = valuesCNV$data)#
	}#
)#
#
output$interrepCNV <- renderText({#
	data.interrep <- as.data.frame(interrepvarCNV()[["data"]])#
	betweenrep <- varBetweenCNV(data.interrep[,2], data.interrep[,1])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarABS <- eventReactive(input$calcInterrepABS,{#
		list(data = values$data,Vp=as.numeric(input$interrepVp))#
	}#
)#
#
output$interrepABS <- renderText({#
	data.interrep <- as.data.frame(interrepvarABS()[["data"]])#
	betweenrep <- varBetween(data.interrep[,2], data.interrep[,1], interrepvarABS()[["Vp"]])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
valuesCNV <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples*2))), Total = c(rep(0,(numSamples*2))), Target = c(rep(TRUE,numSamples),rep(FALSE,numSamples)), stringsAsFactors=FALSE))#
#
adjust.dataCNV <- function(df_){#
  	n <- nrow(df_)#
  	if(n<(input$nsampleCNV*2)){#
		df_[(n+1):input$nsampleCNV*2,1]<-0#
  		df_[(n+1):input$nsampleCNV*2,2]<-0#
  		df_[1:input$nsampleCNV,3]<-TRUE#
  		df_[(input$nsampleCNV+1):(input$nsampleCNV*2),3]<-FALSE#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsampleCNV*2,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    df_$Target<-as.logical(df_$Target)#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
})#
#
observeEvent(input$nsampleCNV,({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
  	valuesCNV$data<-adjust.dataCNV(valuesCNV$data)#
})#
)#
output$hotCNV <- renderRHandsontable({#
        rhandsontable(valuesCNV$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0") %>%#
  			hot_col("Target")#
})   #
interrepvarCNV <- eventReactive(input$calcInterrepCNV,{#
		list(data = valuesCNV$data)#
	}#
)#
#
output$interrepCNV <- renderText({#
	data.interrep <- as.data.frame(interrepvarCNV()[["data"]])#
	betweenrep <- varBetweenCNV(data.interrep[,2], data.interrep[,1])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
data=data.frame(Positives = c(rep(0,(numSamples*2))), Total = c(rep(0,(numSamples*2))), Target = c(rep(TRUE,numSamples),rep(FALSE,numSamples)), stringsAsFactors=FALSE)
data
nsampleCNV=5
n <- nrow(data)
n
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarABS <- eventReactive(input$calcInterrepABS,{#
		list(data = values$data,Vp=as.numeric(input$interrepVp))#
	}#
)#
#
output$interrepABS <- renderText({#
	data.interrep <- as.data.frame(interrepvarABS()[["data"]])#
	betweenrep <- varBetween(data.interrep[,2], data.interrep[,1], interrepvarABS()[["Vp"]])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
valuesCNV <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples*2))), Total = c(rep(0,(numSamples*2))), Target = c(rep(TRUE,numSamples),rep(FALSE,numSamples)), stringsAsFactors=FALSE))#
#
adjust.dataCNV <- function(df_){#
  	n <- nrow(df_)#
  	if(n<(input$nsampleCNV*2)){#
		df_[(n+1):input$nsampleCNV*2,1]<-0#
  		df_[(n+1):input$nsampleCNV*2,2]<-0#
  		df_[1:input$nsampleCNV,3]<-TRUE#
  		df_[(input$nsampleCNV+1):(input$nsampleCNV*2),3]<-FALSE#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:(input$nsampleCNV*2),]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    df_$Target<-as.logical(df_$Target)#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
})#
#
observeEvent(input$nsampleCNV,({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
  	valuesCNV$data<-adjust.dataCNV(valuesCNV$data)#
})#
)#
output$hotCNV <- renderRHandsontable({#
        rhandsontable(valuesCNV$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0") %>%#
  			hot_col("Target")#
})   #
interrepvarCNV <- eventReactive(input$calcInterrepCNV,{#
		list(data = valuesCNV$data)#
	}#
)#
#
output$interrepCNV <- renderText({#
	data.interrep <- as.data.frame(interrepvarCNV()[["data"]])#
	betweenrep <- varBetweenCNV(data.interrep[,2], data.interrep[,1])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarABS <- eventReactive(input$calcInterrepABS,{#
		list(data = values$data,Vp=as.numeric(input$interrepVp))#
	}#
)#
#
output$interrepABS <- renderText({#
	data.interrep <- as.data.frame(interrepvarABS()[["data"]])#
	betweenrep <- varBetween(data.interrep[,2], data.interrep[,1], interrepvarABS()[["Vp"]])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
valuesCNV <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples*2))), Total = c(rep(0,(numSamples*2))), Target = c(rep(TRUE,numSamples),rep(FALSE,numSamples)), stringsAsFactors=FALSE))#
#
adjust.dataCNV <- function(df_){#
  	n <- nrow(df_)#
  	if(n<(input$nsampleCNV*2)){#
		df_[(n+1):(input$nsampleCNV*2),1]<-0#
  		df_[(n+1):(input$nsampleCNV*2),2]<-0#
  		df_[1:input$nsampleCNV,3]<-TRUE#
  		df_[(input$nsampleCNV+1):(input$nsampleCNV*2),3]<-FALSE#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:(input$nsampleCNV*2),]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    df_$Target<-as.logical(df_$Target)#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
})#
#
observeEvent(input$nsampleCNV,({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
  	valuesCNV$data<-adjust.dataCNV(valuesCNV$data)#
})#
)#
output$hotCNV <- renderRHandsontable({#
        rhandsontable(valuesCNV$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0") %>%#
  			hot_col("Target")#
})   #
interrepvarCNV <- eventReactive(input$calcInterrepCNV,{#
		list(data = valuesCNV$data)#
	}#
)#
#
output$interrepCNV <- renderText({#
	data.interrep <- as.data.frame(interrepvarCNV()[["data"]])#
	betweenrep <- varBetweenCNV(data.interrep[,2], data.interrep[,1])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarABS <- eventReactive(input$calcInterrepABS,{#
		list(data = values$data,Vp=as.numeric(input$interrepVp))#
	}#
)#
#
output$interrepABS <- renderText({#
	data.interrep <- as.data.frame(interrepvarABS()[["data"]])#
	betweenrep <- varBetween(data.interrep[,2], data.interrep[,1], interrepvarABS()[["Vp"]])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
valuesCNV <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples*2))), Total = c(rep(0,(numSamples*2))), Target = c(rep(TRUE,numSamples),rep(FALSE,numSamples)), stringsAsFactors=FALSE))#
#
adjust.dataCNV <- function(df_){#
  	n <- nrow(df_)#
  	if(n<(input$nsampleCNV*2)){#
		df_[(n+1):(input$nsampleCNV*2),1]<-0#
  		df_[(n+1):(input$nsampleCNV*2),2]<-0#
  		df_[1:input$nsampleCNV,3]<-TRUE#
  		df_[(input$nsampleCNV+1):(input$nsampleCNV*2),3]<-FALSE#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[c(1:(input$nsampleCNV),(n/2+1):(n/2+1+input$nsampleCNV)),]#
  		df_[1:input$nsampleCNV,3]<-TRUE#
  		df_[(input$nsampleCNV+1):(input$nsampleCNV*2),3]<-FALSE	  	#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    df_$Target<-as.logical(df_$Target)#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
})#
#
observeEvent(input$nsampleCNV,({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
  	valuesCNV$data<-adjust.dataCNV(valuesCNV$data)#
})#
)#
output$hotCNV <- renderRHandsontable({#
        rhandsontable(valuesCNV$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0") %>%#
  			hot_col("Target")#
})   #
interrepvarCNV <- eventReactive(input$calcInterrepCNV,{#
		list(data = valuesCNV$data)#
	}#
)#
#
output$interrepCNV <- renderText({#
	data.interrep <- as.data.frame(interrepvarCNV()[["data"]])#
	betweenrep <- varBetweenCNV(data.interrep[,2], data.interrep[,1])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarABS <- eventReactive(input$calcInterrepABS,{#
		list(data = values$data,Vp=as.numeric(input$interrepVp))#
	}#
)#
#
output$interrepABS <- renderText({#
	data.interrep <- as.data.frame(interrepvarABS()[["data"]])#
	betweenrep <- varBetween(data.interrep[,2], data.interrep[,1], interrepvarABS()[["Vp"]])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
valuesCNV <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples*2))), Total = c(rep(0,(numSamples*2))), Target = c(rep(TRUE,numSamples),rep(FALSE,numSamples)), stringsAsFactors=FALSE))#
#
adjust.dataCNV <- function(df_){#
  	n <- nrow(df_)#
  	if(n<(input$nsampleCNV*2)){#
		df_[(n+1):(input$nsampleCNV*2),1]<-0#
  		df_[(n+1):(input$nsampleCNV*2),2]<-0#
  		df_[1:input$nsampleCNV,3]<-TRUE#
  		df_[(input$nsampleCNV+1):(input$nsampleCNV*2),3]<-FALSE#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[c(1:(input$nsampleCNV),(n/2+1):(n/2+input$nsampleCNV)),]#
  		df_[1:input$nsampleCNV,3]<-TRUE#
  		df_[(input$nsampleCNV+1):(input$nsampleCNV*2),3]<-FALSE	  	#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    df_$Target<-as.logical(df_$Target)#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
})#
#
observeEvent(input$nsampleCNV,({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
  	valuesCNV$data<-adjust.dataCNV(valuesCNV$data)#
})#
)#
output$hotCNV <- renderRHandsontable({#
        rhandsontable(valuesCNV$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0") %>%#
  			hot_col("Target")#
})   #
interrepvarCNV <- eventReactive(input$calcInterrepCNV,{#
		list(data = valuesCNV$data)#
	}#
)#
#
output$interrepCNV <- renderText({#
	data.interrep <- as.data.frame(interrepvarCNV()[["data"]])#
	betweenrep <- varBetweenCNV(data.interrep[,2], data.interrep[,1])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
matrix(c(1:4),2,2)
sum(matrix(c(1:4),2,2))
varBetweenCNV <- function(data){#
	data.target <- data[data[,3]==TRUE,1:2]#
	data.ref <- data[data[,3]==FALSE,1:2]#
	v <- sum(data.target)#
	return(v)	#
}
server<-function(input, output)({#
#
paramsABS <- eventReactive(input$calcResultsABS,{#
		list(replicates=as.numeric(input$replicates),#
			partitions=as.numeric(input$partitions),#
			interrep=as.numeric(input$interrep),#
			effect=as.numeric(input$effect),#
			fraction=as.numeric(input$fraction),#
			significance=as.numeric(input$significance),#
			Vp=as.numeric(input$Vp),#
			alternative=input$Alt,#
			minpart=as.numeric(input$minpart),#
			maxpart=as.numeric(input$maxpart),#
			minrep=as.numeric(input$minrep),#
			maxrep=as.numeric(input$maxrep),#
			mineffect=as.numeric(input$mineffect),#
			maxeffect=as.numeric(input$maxeffect),#
			minrepl=as.numeric(input$minrepl),#
			maxrepl=as.numeric(input$maxrepl))#
	}#
)#
paramsCNV <- eventReactive(input$calcResultsCNV,{#
		list(replicates=as.numeric(input$replicatesCNV),#
			partitions=as.numeric(input$partitionsCNV),#
			interrep=as.numeric(input$interrepCNV),#
			effect=as.numeric(input$effectCNV),#
			fraction=as.numeric(input$fractionCNV),#
			significance=as.numeric(input$significanceCNV),#
			NB=as.numeric(input$NB),#
			alternative=input$AltCNV,#
			minpart=as.numeric(input$minpartCNV),#
			maxpart=as.numeric(input$maxpartCNV),#
			minrep=as.numeric(input$minrepCNV),#
			maxrep=as.numeric(input$maxrepCNV),#
			mineffect=as.numeric(input$mineffectCNV),#
			maxeffect=as.numeric(input$maxeffectCNV),#
			minrepl=as.numeric(input$minreplCNV),#
			maxrepl=as.numeric(input$maxreplCNV))#
	}#
)#
#
paramsREL <- eventReactive(input$calcResultsREL,{#
		list(replicates=as.numeric(input$replicatesREL),#
			partitions=as.numeric(input$partitionsREL),#
			interrep=as.numeric(input$interrepREL),#
			effect=as.numeric(input$effectREL),#
			fraction=as.numeric(input$fractionREL),#
			significance=as.numeric(input$significanceREL),#
			NB=as.numeric(input$NBREL),#
			alternative=input$AltREL,#
			minpart=as.numeric(input$minpartREL),#
			maxpart=as.numeric(input$maxpartREL),#
			minrep=as.numeric(input$minrepREL),#
			maxrep=as.numeric(input$maxrepREL),#
			mineffect=as.numeric(input$mineffectREL),#
			maxeffect=as.numeric(input$maxeffectREL),#
			minrepl=as.numeric(input$minreplREL),#
			maxrepl=as.numeric(input$maxreplREL))#
	}#
)#
#
output$textABS <- renderText({#
	pwr <- power.ddPCR.abs.fixed(delta=paramsABS()[["effect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
output$textCNV <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsCNV()[["effect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$textREL <- renderText({#
	pwr <- power.ddPCR.fixed(delta=paramsREL()[["effect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1)#
	)#
	paste0("The power for the specified parameters is: ", round(pwr*100,2), "%.")#
})#
#
output$plotABS <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR.abs(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			Nmin=paramsABS()[["minpart"]],#
			Nmax=paramsABS()[["maxpart"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.abs.N(delta=paramsABS()[["mineffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.N(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.N(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.N(delta=paramsABS()[["maxeffect"]],#
			r=paramsABS()[["replicates"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.abs.r(delta=paramsABS()[["mineffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.r(delta=1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.r(delta=1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]]),#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.r(delta=paramsABS()[["maxeffect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			rmin=paramsABS()[["minrep"]],#
			rmax=paramsABS()[["maxrep"]],#
			interrep=paramsABS()[["interrep"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsABS()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsABS()[["mineffect"]]+paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsABS()[["mineffect"]]+2*paramsABS()[["maxeffect"]])*100,"%"),#
					paste0(paramsABS()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["minrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.abs.VB(delta=paramsABS()[["effect"]],#
			NNeg.fr=paramsABS()[["fraction"]],#
			Vp=paramsABS()[["Vp"]],#
			alpha=paramsABS()[["significance"]],#
			N=paramsABS()[["partitions"]],#
			r=paramsABS()[["maxrep"]],#
			interrepmin=paramsABS()[["minrepl"]],#
			interrepmax=paramsABS()[["maxrepl"]],#
			alternative=paramsABS()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsABS()[["minrep"]]),#
					floor(1/3*(2*paramsABS()[["minrep"]]+paramsABS()[["maxrep"]])),#
					ceiling(1/3*(paramsABS()[["minrep"]]+2*paramsABS()[["maxrep"]])),#
					(paramsABS()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotCNV <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			Nmin=paramsCNV()[["minpart"]],#
			Nmax=paramsCNV()[["maxpart"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsCNV()[["mineffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsCNV()[["maxeffect"]],#
			r=paramsCNV()[["replicates"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsCNV()[["mineffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]]),#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsCNV()[["maxeffect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			rmin=paramsCNV()[["minrep"]],#
			rmax=paramsCNV()[["maxrep"]],#
			interrep=paramsCNV()[["interrep"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsCNV()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsCNV()[["mineffect"]]+paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsCNV()[["mineffect"]]+2*paramsCNV()[["maxeffect"]])*100,"%"),#
					paste0(paramsCNV()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["minrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsCNV()[["effect"]],#
			NNeg.fr=paramsCNV()[["fraction"]],#
			NB=paramsCNV()[["NB"]],#
			alpha=paramsCNV()[["significance"]],#
			N=paramsCNV()[["partitions"]],#
			r=paramsCNV()[["maxrep"]],#
			interrepmin=paramsCNV()[["minrepl"]],#
			interrepmax=paramsCNV()[["maxrepl"]],#
			alternative=paramsCNV()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsCNV()[["minrep"]]),#
					floor(1/3*(2*paramsCNV()[["minrep"]]+paramsCNV()[["maxrep"]])),#
					ceiling(1/3*(paramsCNV()[["minrep"]]+2*paramsCNV()[["maxrep"]])),#
					(paramsCNV()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
#
output$plotREL <- renderPlot({#
	par(mfrow=c(2,2))#
	#effect size / number of partitions#
	power.ddPCR(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			Nmin=paramsREL()[["minpart"]],#
			Nmax=paramsREL()[["maxpart"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")#
#
	power.ddPCR.N(delta=paramsREL()[["mineffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.N(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.N(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.N(delta=paramsREL()[["maxeffect"]],#
			r=paramsREL()[["replicates"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
	power.ddPCR.r(delta=paramsREL()[["mineffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.r(delta=1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.r(delta=1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]]),#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.r(delta=paramsREL()[["maxeffect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			rmin=paramsREL()[["minrep"]],#
			rmax=paramsREL()[["maxrep"]],#
			interrep=paramsREL()[["interrep"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c(paste0(paramsREL()[["mineffect"]]*100,"%"),#
					paste0(1/3*(2*paramsREL()[["mineffect"]]+paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(1/3*(paramsREL()[["mineffect"]]+2*paramsREL()[["maxeffect"]])*100,"%"),#
					paste0(paramsREL()[["maxeffect"]]*100,"%"))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Effect size")	#
#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["minrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1))#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			ylim=c(0,1),#
			add=T,lty=2)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=3)#
	power.ddPCR.VB(delta=paramsREL()[["effect"]],#
			NNeg.fr=paramsREL()[["fraction"]],#
			NB=paramsREL()[["NB"]],#
			alpha=paramsREL()[["significance"]],#
			N=paramsREL()[["partitions"]],#
			r=paramsREL()[["maxrep"]],#
			interrepmin=paramsREL()[["minrepl"]],#
			interrepmax=paramsREL()[["maxrepl"]],#
			alternative=paramsREL()[["alternative"]],#
			add=T,lty=4)#
	legend.char <- c((paramsREL()[["minrep"]]),#
					floor(1/3*(2*paramsREL()[["minrep"]]+paramsREL()[["maxrep"]])),#
					ceiling(1/3*(paramsREL()[["minrep"]]+2*paramsREL()[["maxrep"]])),#
					(paramsREL()[["maxrep"]]))	#
	legend("bottomright",legend=legend.char,lty=c(1:4), title="Replicates")	#
})#
##########################
# BETWEEN-REP VARIATION ##
##########################
#
values <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples))), Total = c(rep(0,(numSamples)))))#
#
adjust.data <- function(df_){#
  	n <- nrow(df_)#
  	if(n<input$nsample){#
		df_[(n+1):input$nsample,1]<-0#
  		df_[(n+1):input$nsample,2]<-0#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[1:input$nsample,]#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
})#
#
observeEvent(input$nsample,({#
	if(!is.null(input$hot)){#
		values$data <- hot_to_r(input$hot)#
	}#
  	values$data<-adjust.data(values$data)#
})#
)#
output$hot <- renderRHandsontable({#
        rhandsontable(values$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0")#
})   #
interrepvarABS <- eventReactive(input$calcInterrepABS,{#
		list(data = values$data,Vp=as.numeric(input$interrepVp))#
	}#
)#
#
output$interrepABS <- renderText({#
	data.interrep <- as.data.frame(interrepvarABS()[["data"]])#
	betweenrep <- varBetween(data.interrep[,2], data.interrep[,1], interrepvarABS()[["Vp"]])#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
valuesCNV <- reactiveValues(data=data.frame(Positives = c(rep(0,(numSamples*2))), Total = c(rep(0,(numSamples*2))), Target = c(rep(TRUE,numSamples),rep(FALSE,numSamples)), stringsAsFactors=FALSE))#
#
adjust.dataCNV <- function(df_){#
  	n <- nrow(df_)#
  	if(n<(input$nsampleCNV*2)){#
		df_[(n+1):(input$nsampleCNV*2),1]<-0#
  		df_[(n+1):(input$nsampleCNV*2),2]<-0#
  		df_[1:input$nsampleCNV,3]<-TRUE#
  		df_[(input$nsampleCNV+1):(input$nsampleCNV*2),3]<-FALSE#
  		row.names(df_)<-1:nrow(df_)#
  	}else{#
	  	df_<- df_[c(1:(input$nsampleCNV),(n/2+1):(n/2+input$nsampleCNV)),]#
  		df_[1:input$nsampleCNV,3]<-TRUE#
  		df_[(input$nsampleCNV+1):(input$nsampleCNV*2),3]<-FALSE	  	#
   		row.names(df_)<-1:nrow(df_) 		#
  	}#
    df_$Positives<-as.numeric(df_$Positives)#
    df_$Total<-as.numeric(df_$Total)	#
    df_$Target<-as.logical(df_$Target)#
    return(df_)#
}#
#
observe({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
})#
#
observeEvent(input$nsampleCNV,({#
	if(!is.null(input$hotCNV)){#
		valuesCNV$data <- hot_to_r(input$hotCNV)#
	}#
  	valuesCNV$data<-adjust.dataCNV(valuesCNV$data)#
})#
)#
output$hotCNV <- renderRHandsontable({#
        rhandsontable(valuesCNV$data,readOnly=F, useTypes= TRUE) %>%#
      		hot_table(highlightCol = TRUE, highlightRow = FALSE) %>%#
  			hot_col("Positives", format = "0") %>%#
  			hot_col("Total", format = "0") %>%#
  			hot_col("Target")#
})   #
interrepvarCNV <- eventReactive(input$calcInterrepCNV,{#
		list(data = valuesCNV$data)#
	}#
)#
#
output$interrepCNV <- renderText({#
	data.interrep <- as.data.frame(interrepvarCNV()[["data"]])#
	betweenrep <- varBetweenCNV(data.interrep)#
	if(betweenrep<0){#
		paste0("There is no evidence for between-replicate variation.")#
	} else {#
		paste0("The between-replicate variation is: ", betweenrep, ".")#
	}#
})#
output$reportGenerateCNV <- downloadHandler(#
	filename = function() {#
		paste(paste("report",strftime(strptime(date(),format="%a %b %d %H:%M:%S %Y"),format="%Y%m%d%H%M%S"), sep=''), sep = '.', 'pdf')#
	},#
	content = function(file) {#
		src <- normalizePath('report.Rmd')#
		df_ <- values$data#
		# temporarily switch to the temp dir, in case you do not have write#
		# permission to the current working directory#
		owd <- setwd(tempdir())#
		on.exit(setwd(owd))#
		file.copy(src, 'report.Rmd',overwrite=TRUE)#
		library(rmarkdown) #
		outReport <- rmarkdown::render('report.Rmd', pdf_document(),params=list(ls()))#
		file.rename(outReport, file)#
	}	#
)#
#
})
shinyApp(ui,server)
varBetweenCNV <- function(data,NB=1){#
	data.target <- data[data[,3]==TRUE,1:2]#
	data.ref <- data[data[,3]==FALSE,1:2]#
	vTotal <- var(log(1-data.target[,1]/data.target[,2])/log(1-data.ref[,1]/data.ref[,2]))*NB^2#
	vPois <- calcPoisVar(data.target,data.ref)*NB^2#
	v <- vTotal - vPois#
	return(v)	#
}#
#
calcPoisVar <- function(data.subset,ref.subset){#
	pA <- mean((data.subset[,1]/(data.subset[,2])), na.rm = TRUE)#
	pB <- mean((ref.subset[,1]/(ref.subset[,2])), na.rm = TRUE)#
	VarPA<-pA*(1-pA)/mean(data.subset[,2]), na.rm = TRUE)#
	VarPB<-pB*(1-pB)/mean(ref.subset[,2]), na.rm = TRUE)#
	delta <- log(pA)/log(pB)#
	NB <- 1#
	poisVar<-(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB#
	return(poisVar)#
}
calcPoisVar <- function(data.subset,ref.subset){#
	pA <- mean((data.subset[,1]/(data.subset[,2])), na.rm = TRUE)#
	pB <- mean((ref.subset[,1]/(ref.subset[,2])), na.rm = TRUE)#
	VarPA<-pA*(1-pA)/mean(data.subset[,2], na.rm = TRUE)#
	VarPB<-pB*(1-pB)/mean(ref.subset[,2], na.rm = TRUE)#
	delta <- log(pA)/log(pB)#
	NB <- 1#
	poisVar<-(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB#
	return(poisVar)#
}
data <- read.csv("~/Dropbox/Work/Matthijs-Olivier/dPCR/CNVReplicates/Data/NIPD/NIPDmerged.csv",sep=";")#
head(data)#
calcPoisVar <- function(data.subset,ref.subset){#
	pA <- mean(unlist(unname(c(data.subset[2]/rowSums(data.subset)))), na.rm = TRUE)#
	pB <- mean(unlist(unname(c(ref.subset[2]/rowSums(ref.subset)))), na.rm = TRUE)#
	VarPA<-pA*(1-pA)/mean(unname(rowSums(data.subset)), na.rm = TRUE)#
	VarPB<-pB*(1-pB)/mean(unname(rowSums(ref.subset)), na.rm = TRUE)#
	delta <- log(pA)/log(pB)#
	NB <- 1#
	poisVar<-(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB#
	return(poisVar)#
}#
#
n <- c()#
frac.neg <- c()#
RQ <- c()#
CN <- c()#
CN.mean <- c()#
CN.var <- c()#
pois.var <- c()#
n.repl <- c()
i=1
j=1
n <- c()#
frac.neg <- c()#
RQ <- c()#
CN <- c()#
CN.mean <- c()#
CN.var <- c()#
pois.var <- c()#
n.repl <- c()
cols <- c(i*2-1, i*2) + 1#
		rows <- c((j*3-2):(j*3))#
		data.subset <- data[rows, cols]#
		ref.subset <- data[rows, 28:29]#
		n <- c(n, unname(rowSums(data.subset)))#
		frac.neg <- c(frac.neg, unlist(unname(c(data.subset[2]/rowSums(data.subset)))))#
		CN.subset <- log(unlist(unname(c(data.subset[2]/rowSums(data.subset)))))/log(unlist(unname(c(ref.subset[2]/rowSums(ref.subset)))))#
		CN <- c(CN, CN.subset)#
		CN.mean <- c(CN.mean, mean(CN.subset, na.rm = TRUE))#
		CN.var <- c(CN.var, var(CN.subset, na.rm = TRUE))#
		pois.var <- c(pois.var, calcPoisVar(data.subset, ref.subset))#
		n.repl <- c(n.repl, sum(complete.cases(data.subset[,1])))
data.subset
ref.subset
CN.var
pois.var
data<-cbind(data.subset,ref.subset)
data
data<-as.data.frame(rbind(data.subset,ref.subset))
data<-as.data.frame(unname(rbind(unname(data.subset),unname(ref.subset))))
unname(rbind(unname(data.subset),unname(ref.subset)))
unname(rbind((data.subset),(ref.subset)))
data.subset
unname(data.subset)
rbind(unname(data.subset),unname(ref.subset))
colnames(ref.subset)<-colnames(data.subset)
data<-as.data.frame(rbind(data.subset,ref.subset))
data
data$Target=c(rep(TRUE,3),rep(FALSE,3))
data
CN.var-pois.var
varBetweenCNV(data)
varBetweenCNV(data,)
varBetweenCNV(data,2)
calcPoisVar <- function(data.subset,ref.subset){#
	pA <- mean((data.subset[,1]/(data.subset[,2])), na.rm = TRUE)#
	pB <- mean((ref.subset[,1]/(ref.subset[,2])), na.rm = TRUE)#
	VarPA<-pA*(1-pA)/mean(data.subset[,2], na.rm = TRUE)#
	VarPB<-pB*(1-pB)/mean(ref.subset[,2], na.rm = TRUE)#
	delta <- log(pA)/log(pB)#
	NB <- 1#
	poisVar<-(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB#
	return(poisVar)#
}
varBetweenCNV(data,2)
varBetweenCNV(data)
pois.var
calcPoisVar(data[data[,3]==TRUE,1:2],data[data[,3]==FALSE,1:2])
data[,2]<-data[,1]+data[,2]
calcPoisVar(data[data[,3]==TRUE,1:2],data[data[,3]==FALSE,1:2])
data
data.subset
ref.subset
pA <- mean(unlist(unname(c(data.subset[2]/rowSums(data.subset)))), na.rm = TRUE)
pA
pB <- mean(unlist(unname(c(ref.subset[2]/rowSums(ref.subset)))), na.rm = TRUE)
pB
calcPoisVar <- function(data.subset,ref.subset){#
	pA <- mean(1-(data.subset[,1]/(data.subset[,2])), na.rm = TRUE)#
	pB <- mean(1-(ref.subset[,1]/(ref.subset[,2])), na.rm = TRUE)#
	VarPA<-pA*(1-pA)/mean(data.subset[,2], na.rm = TRUE)#
	VarPB<-pB*(1-pB)/mean(ref.subset[,2], na.rm = TRUE)#
	delta <- log(pA)/log(pB)#
	NB <- 1#
	poisVar<-(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB#
	return(poisVar)#
}
calcPoisVar(data[data[,3]==TRUE,1:2],data[data[,3]==FALSE,1:2])
varBetweenCNV(data)
CN.var-pois.var
varBetweenCNV <- function(data,NB=1){#
	data.target <- data[data[,3]==TRUE,1:2]#
	data.ref <- data[data[,3]==FALSE,1:2]#
	vTotal <- var(log(1-data.target[,1]/data.target[,2])/log(1-data.ref[,1]/data.ref[,2]))*NB^2#
	vPois <- calcPoisVar(data.target,data.ref)*NB^2#
	v <- vTotal - vPois#
	return(v)	#
}#
#
calcPoisVar <- function(data.subset,ref.subset){#
	pA <- mean(1-(data.subset[,1]/(data.subset[,2])), na.rm = TRUE)#
	pB <- mean(1-(ref.subset[,1]/(ref.subset[,2])), na.rm = TRUE)#
	VarPA<-pA*(1-pA)/mean(data.subset[,2], na.rm = TRUE)#
	VarPB<-pB*(1-pB)/mean(ref.subset[,2], na.rm = TRUE)#
	delta <- log(pA)/log(pB)#
	NB <- 1#
	poisVar<-(NB*delta/(pA*log(pA)))^2*VarPA+(NB*delta^2/(log(pA)*pB))^2*VarPB#
	return(poisVar)#
}
